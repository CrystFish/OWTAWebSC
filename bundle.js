"use strict";(()=>{var M={};function p(...s){console.log(...s)}function T(s){M[s]=loadJSON(s)}function at(s){M[s]=loadSound(s)}function lt(s){if(s in M)return new J(M[s]);throw new Error(`JSON object was not preloaded! Path: ${s}`)}function ut(s,e){throw new Error("Method not implemented.")}function $e(){window.location.reload()}var G=class{loadFile(e){if(e in M){let t=M[e];return new Ze(t)}else throw new Error(`Audio file was not preloaded! Path: ${e}`)}},Ze=class{constructor(e){this._sound=e}play(){this._sound.play()}pause(){this._sound.pause()}},I=class{constructor(e=[]){this._data=e}size(){return this._data.length}getJSONObject(e){let t=this._data[e];return typeof t=="object"&&!(t instanceof J)?new J(t):t}getString(e){return this._data[e]}toJSON(e){return this._data}},J=class s{constructor(e={}){this._data=e}hasKey(e){return e in this._data}getFloat(e,t){let o=this._data[e];return o==null?t:typeof o=="number"?o:Number(o)}getInt(e,t){let o=this._data[e];return o==null?t:typeof o=="number"?o:Number(o)}getString(e,t){let o=this._data[e];return o==null?t:typeof o=="string"?o:JSON.stringify(o)}getBoolean(e,t){let o=this._data[e];return o==null?t:typeof o=="boolean"?o:!!o}getJSONArray(e){let t=this._data[e];return Array.isArray(t)&&!(t instanceof I)?new I(t):e in this._data?t:null}getJSONObject(e){let t=this._data[e];return typeof t=="object"&&!(t instanceof s)?new s(t):e in this._data?t:null}setFloat(e,t){return this._data[e]=t,this}setInt(e,t){return this._data[e]=t,this}setString(e,t){return this._data[e]=t,this}setBoolean(e,t){return this._data[e]=t,this}setJSONArray(e,t){return this._data[e]=t,this}setJSONObject(e,t){return this._data[e]=t,this}keys(){return Object.keys(this._data)}toJSON(e){return this._data}};var W=class s{static loadSounds(){p("Sounds loading..."),s.kazooTheme=et.loadFile("data/audio/ow_kazoo_theme.mp3")}},A=class s{constructor(){W.loadSounds()}static play(e){s.currentSound=e,s.currentSound.play()}static pause(){s.currentSound!=null?s.currentSound.pause():p("Current sound is NULL!!!")}};var j=(o=>(o[o.BEACON=0]="BEACON",o[o.QUANTUM=1]="QUANTUM",o[o.TRAVELER=2]="TRAVELER",o))(j||{});var h=class s{constructor(e,t){this.x=e instanceof s?e.x:typeof e=="number"?e:0,this.y=e instanceof s?e.y:typeof t=="number"?t:0}assign(e){this.x=e.x,this.y=e.y}toString(){return"("+this.x+", "+this.y+")"}dist(e){return e.sub(this).magnitude()}add(e){return new s(this.x+e.x,this.y+e.y)}sub(e){return new s(this.x-e.x,this.y-e.y)}mult(e){return new s(this.x*e,this.y*e)}scale(e){return this.x*=e,this.y*=e,this}magnitude(){return Math.max(Math.sqrt(this.x*this.x+this.y*this.y),.001)}normalize(){let e=this.magnitude();return this.x/=e,this.y/=e,this}normalized(){let e=this.magnitude();return new s(this.x/e,this.y/e)}theta(){return Math.atan2(this.y,this.x)}dx(){return this.x/this.magnitude()}dy(){return this.y/this.magnitude()}leftNormal(){return new s(this.y,-this.x)}rightNormal(){return new s(-this.y,this.x)}dot(e){return this.x*e.x+this.y*e.y}scaledDot(e){return this.x*e.dx()+this.y*e.dy()}projectOnto(e){let t=this.scaledDot(e);return new s(t*e.dx(),t*e.dy())}};var f=class{constructor(e,t){this.parent=null;let o=new h;typeof e=="number"&&typeof t=="number"?o=new h(e,t):e instanceof h&&(o=e),this.position=new h,this.screenPosition=new h,this._children=[],this.setPosition(o)}setPosition(e,t){this.position.x=e instanceof h?e.x:e,this.position.y=e instanceof h?e.y:t??0,this.parent!=null?this.updateScreenPosition(this.parent.screenPosition):this.updateScreenPosition(new h(0,0))}updateScreenPosition(e){this.screenPosition.assign(e.add(this.position));for(let t=0;t<this._children.length;t++)this._children[t].updateScreenPosition(this.screenPosition)}setScreenPosition(e){this.parent==null?this.setPosition(e):this.setPosition(e.sub(this.parent.screenPosition))}draw(){}render(){this.draw()}addChild(e){this._children.includes(e)||(this._children.push(e),e.parent=this,e.updateScreenPosition(this.screenPosition))}removeChild(e){this._children.includes(e)&&this._children.splice(this._children.indexOf(e),1),e.parent=null}},H=class s extends f{constructor(){super(new h(0,0));this.currentSector=null;this.lastSector=null;this.currentNode=null;this._moveTowardsTarget=!1;this._distToTarget=0;this._targetScreenPos=new h,this._offset=new h(0,0)}static{this.SPEED=10}isDead(){return!1}update(){if(this._offset.y=0,(this.currentNode==null||!this.currentNode.gravity)&&(this._offset.y=Math.sin(millis()*.005)*5),this._moveTowardsTarget){let t=this._targetScreenPos.sub(this.screenPosition);this._distToTarget=t.magnitude();let o=Math.min(this._distToTarget,s.SPEED);this.setScreenPosition(this.screenPosition.add(t.normalize().mult(o)))}}draw(){fill(0,0,100),ellipse(this.screenPosition.x,this.screenPosition.y,10,10)}setNode(t){this.currentNode=t,this._targetScreenPos.assign(t.screenPosition),this.setScreenPosition(t.screenPosition)}moveToScreenPosition(t){this._targetScreenPos.assign(t),this._moveTowardsTarget=!0}moveToNode(t){this.currentNode=t,this._targetScreenPos.assign(t.screenPosition),this._moveTowardsTarget=!0}},z=class extends H{setNode(e){super.setNode(e),e.visit()}moveToNode(e){super.moveToNode(e),e.visit()}update(){super.update()}draw(){this.drawAt(this.screenPosition.x,this.screenPosition.y+this._offset.y,1)}drawAt(e,t,o){stroke(30,100,100),fill(0,0,0),push(),translate(e,t),scale(o),ellipse(0,0,10,20),pop()}},Q=class extends H{constructor(e){super(),this._player=e}update(){super.update()}draw(){this.drawAt(this.screenPosition.x,this.screenPosition.y+this._offset.y,1,!1)}drawAt(e,t,o,n){stroke(30,100,100),fill(0,0,0),this._player.currentNode==this.currentNode&&!n&&fill(30,100,100),push(),translate(e,t),scale(o),triangle(-20,15,20,15,0,-20),pop()}},K=class extends H{isDead(){return this._distToTarget<.1}update(){super.update()}draw(){noStroke(),fill(30,100,100),push(),translate(this.screenPosition.x,this.screenPosition.y),ellipse(0,0,10,10),pop()}};var a=class extends f{constructor(t,o=0,n=0,l=150,b=50){super(new h(o,n));this.hoverState=!1;this.visible=!0;this.enabled=!0;this._buttonDown=!1;this._wasMousePressed=!1;this._buttonColor=color(0,0,100);this._hasDisabledPrompt=!1;this.id=this._disabledPrompt=t,this._bounds=new h(l,b)}setColor(t){this._buttonColor=t}setDisabledPrompt(t){this._disabledPrompt=t,this._hasDisabledPrompt=!0}getWidth(){return this._bounds.x}setObserver(t){this._observer=t}update(){if(!this.enabled){this._buttonDown=!1,this.hoverState=!1;return}this.isPointInBounds(mouseX,mouseY)?(this.hoverState||(this.hoverState=!0,this.onButtonEnterHover(),this._observer.onButtonEnterHover(this)),!this._wasMousePressed&&this.mousePressed()&&(this._buttonDown=!0),this._buttonDown&&!this.mousePressed()&&(this._buttonDown=!1,this.onButtonUp(),this._observer.onButtonUp(this))):(this._buttonDown=!1,this.hoverState&&(this.hoverState=!1,this.onButtonExitHover(),this._observer.onButtonExitHover(this))),this._wasMousePressed=this.mousePressed()}onButtonExitHover(){}onButtonEnterHover(){}onButtonUp(){}mousePressed(){return mouseIsPressed}draw(){if(!this.visible)return;let t=100;this.enabled||(t=25),stroke(hue(this._buttonColor),saturation(this._buttonColor),brightness(this._buttonColor),t),fill(0,0,0),this.hoverState&&(this._buttonDown?stroke(0,100,100):stroke(200,100,100)),this.drawShape(),this.drawText(t)}drawShape(){rectMode(CENTER),rect(this.screenPosition.x,this.screenPosition.y,this._bounds.x,this._bounds.y)}drawText(t){fill(0,0,100,t),textSize(14),textFont(E),textAlign(CENTER,CENTER),this.enabled?text(this.id,this.screenPosition.x,this.screenPosition.y):text(this._disabledPrompt,this.screenPosition.x,this.screenPosition.y)}isPointInBounds(t,o){return t>this.screenPosition.x-this._bounds.x*.5&&t<this.screenPosition.x+this._bounds.x*.5&&o>this.screenPosition.y-this._bounds.y*.5&&o<this.screenPosition.y+this._bounds.y*.5}};var m=class{constructor(){this.active=!1;this.overlay=!1;this._buttons=new Array,this._toolbarButtons=new Array,this._starPositions=new Array(1e3);for(let e=0;e<this._starPositions.length;e++)this._starPositions[e]=new h(random(0,width),random(90,height-90));this._toolbarRoot=new f(width/2,height-50)}addButton(e){this._buttons.push(e),e.setObserver(this)}removeButton(e){this._buttons.includes(e)&&this._buttons.splice(this._buttons.indexOf(e),1)}addButtonToToolbar(e){this.addButton(e),this._toolbarButtons.push(e),this._toolbarRoot.addChild(e),this.updateToolbarPositions()}removeButtonFromToolbar(e){this.removeButton(e),this._toolbarButtons.splice(this._toolbarButtons.indexOf(e),1),this._toolbarRoot.removeChild(e),this.updateToolbarPositions()}updateToolbarPositions(){let t=-10;for(let n=0;n<this._toolbarButtons.length;n++)t+=10,t+=this._toolbarButtons[n].getWidth();let o=-(t*.5);for(let n=0;n<this._toolbarButtons.length;n++){let l=this._toolbarButtons[n].getWidth()*.5;o+=l,this._toolbarButtons[n].setPosition(o,0),o+=l+10}}onEnter(){}onExit(){}onButtonUp(e){}onButtonEnterHover(e){}onButtonExitHover(e){}updateInput(){for(let e=0;e<this._buttons.length;e++)this._buttons[e].update()}renderBackground(){let e=color(0,0,0),t=color(0,0,100);d.isPlayerAtEOTU()&&(e=color(0,0,100),t=color(0,0,0)),background(e),noStroke();for(let o=0;o<this._starPositions.length;o++)fill(t),rectMode(CENTER),rect(this._starPositions[o].x,this._starPositions[o].y,2,2)}renderButtons(){if(this.active)for(let e=0;e<this._buttons.length;e++)this._buttons[e].render()}};var Y=class extends m{constructor(){super(),this.addButtonToToolbar(new a("\u5173\u95ED\u6570\u636E\u5E93",0,0,150,50)),this._clueRoot=new f(100,140);for(let e=0;e<d.getClueCount();e++){let t=new tt(d.getClueAt(e),e*40,this);this.addButton(t),this._clueRoot.addChild(t)}}setObserver(e){this._observer=e}onEnter(){}onExit(){this._observer=null}onClueMouseOver(e){this._activeClue=e}onClueSelected(e){this._observer!=null?this._observer.onInvokeClue(e):r.publish("\u90A3\u4E2A\u73B0\u5728\u8FD8\u4E0D\u80FD\u5E2E\u52A9\u5230\u4F60",!0)}onButtonUp(e){e.id=="\u5173\u95ED\u6570\u636E\u5E93"&&i.popScreen()}update(){}render(){fill(0,0,0),stroke(0,0,100),rectMode(CORNER);let e=width/2-100,t=200,o=500,n=300;rect(e,t,o,n);let l="\u9009\u62E9\u4E00\u9879\u6761\u76EE";this._activeClue!=null?l=this._activeClue.description:d.getKnownClueCount()==0&&(l="\u6682\u65E0\u6761\u76EE"),textFont(S),textSize(18),textAlign(LEFT,TOP),fill(0,0,100),text(l,e+10,t+10,o-20,n-20),r.render()}},tt=class extends a{constructor(e,t,o){super(e.name,(textWidth(e.name)+10)*.5,t,textWidth(e.name)+10,20),this._clue=e,this._clueObserver=o}getClue(){return this._clue}update(){this.enabled=this._clue.discovered,this.visible=this._clue.discovered,super.update()}draw(){if(!this.visible)return;super.draw();let e;this._clue.curiosity==0?e=color(100,100,100):this._clue.curiosity==3?e=color(200,100,100):this._clue.curiosity==1?e=color(20,100,100):e=color(300,100,100),fill(e),noStroke(),ellipse(this.screenPosition.x-this._bounds.x*.5-20,this.screenPosition.y,10,10),noFill(),stroke(e),ellipse(this.screenPosition.x-this._bounds.x*.5-20,this.screenPosition.y,15,15)}onButtonEnterHover(){this._clueObserver.onClueMouseOver(this._clue)}onButtonUp(){this._clueObserver.onClueSelected(this._clue)}};var X=class{constructor(){this._observers=new Array}addObserver(e){this._observers.includes(e)||this._observers.push(e)}removeObserver(e){this._observers.splice(this._observers.indexOf(e),1)}removeAllObservers(){this._observers.length=0}sendMessage(e){let t=e instanceof C?e:new C(e);for(let o=0;o<this._observers.length;o++)this._observers[o].onReceiveGlobalMessage(t)}},C=class{constructor(e,t){this.id=e,t!==void 0&&(this.text=t)}};var Z=class{constructor(){this._knownClueCount=0;this._isDead=!1;this._knowsLaunchCodes=ht,this._knowsSignalCoordinates=pt,this._clueList=new Array,this._knownFrequencies=new Array,this._knownFrequencies.push(2),ct&&(this._knownFrequencies.push(0),this._knownFrequencies.push(1)),this._clueList.push(new O(3,"APL_1","\u6C89\u5E95\u6A21\u5757","\u6570\u636E\u6536\u96C6\u6A21\u5757\u4ECE\u632A\u9EA6\u63A2\u6D4B\u5668\u53D1\u5C04\u5668\u4E0A\u8131\u843D\uFF0C\u6389\u8FDB\u4E86\u6DF1\u5DE8\u661F\u7684\u4E2D\u5FC3\u3002")),this._clueList.push(new O(3,"APL_2","\u6C79\u6D8C\u7684\u9F99\u5377\u98CE","\u6DF1\u5DE8\u661F\u4E0A\u7684\u5927\u591A\u6570\u9F99\u5377\u98CE\u90FD\u6709\u5F3A\u70C8\u7684\u4E0A\u5347\u6C14\u6D41\uFF0C\u4F46\u6709\u4E9B\u9006\u65F6\u9488\u65CB\u8F6C\u7684\u9F99\u5377\u98CE\u6709\u7740\u4E0B\u884C\u6C14\u6D41")),this._clueList.push(new O(3,"APL_3","\u6C34\u6BCD","\u6DF1\u5DE8\u661F\u6C34\u6BCD\u7684\u7A7A\u8154\u6070\u597D\u80FD\u591F\u5BB9\u4E0B\u4E00\u4E2A\u4EBA")),this._clueList.push(new O(2,"QM_3","\u7B2C\u4E94\u4E2A\u4F4D\u7F6E","\u91CF\u5B50\u536B\u661F\u6709\u65F6\u4F1A\u62DC\u8BBF\u592A\u9633\u7CFB\u5916\u7684\u7B2C\u4E94\u4E2A\u4F4D\u7F6E")),this._clueList.push(new O(2,"QM_1","\u91CF\u5B50\u6210\u50CF","\u89C2\u5BDF\u91CF\u5B50\u7269\u4F53\u7684\u7167\u7247\u4E0E\u76F4\u63A5\u89C2\u5BDF\u7269\u4F53\u672C\u8EAB\u4E00\u6837\uFF0C\u80FD\u6709\u6548\u5730\u9632\u6B62\u7269\u4F53\u79FB\u52A8")),this._clueList.push(new O(2,"QM_2","\u91CF\u5B50\u7EA0\u7F20",`\u666E\u901A\u7269\u4F53\u5728\u9760\u8FD1\u91CF\u5B50\u7269\u4F53\u65F6\u4F1A\u4E0E\u4E4B\u201C\u7EA0\u7F20\u201D\u5728\u4E00\u8D77\uFF0C\u5E76\u5F00\u59CB\u8868\u73B0\u51FA\u91CF\u5B50\u5C5E\u6027

\u53EA\u8981\u65E0\u6CD5\u89C2\u5BDF\u81EA\u5DF1\u6216\u5468\u56F4\u73AF\u5883\uFF0C\u5373\u4F7F\u662F\u751F\u547D\u4F53\u4E5F\u4F1A\u88AB\u7EA0\u7F20`)),this._clueList.push(new O(0,"D_1","\u5931\u843D\u7684\u98DE\u8239","\u632A\u9EA6\u4EBA\u6765\u5230\u8FD9\u4E2A\u592A\u9633\u7CFB\u662F\u4E3A\u4E86\u5BFB\u627E\u5B83\u4EEC\u79F0\u4E4B\u4E3A\u201C\u5B87\u5B99\u4E4B\u773C\u201D\u7684\u795E\u79D8\u7684\u4FE1\u53F7\uFF0C\u5B83\u4EEC\u4E58\u5750\u7684\u98DE\u8239\u5728\u9ED1\u8346\u661F\u7684\u67D0\u5904\u9047\u96BE")),this._clueList.push(new O(0,"D_2","\u5B69\u7AE5\u7684\u6E38\u620F","\u632A\u9EA6\u4EBA\u5B69\u7AE5\u4EEC\u73A9\u4E86\u4E00\u4E2A\u6E38\u620F\uFF0C\u91CD\u73B0\u4E86\u65CF\u4EBA\u9003\u79BB\u9ED1\u8346\u661F\u7684\u60C5\u666F\u3002\u6839\u636E\u6E38\u620F\u89C4\u5219\uFF0C\u4E09\u540D\u73A9\u5BB6\uFF08\u9003\u751F\u8231\uFF09\u5FC5\u987B\u5728\u4E0D\u88AB\u53D1\u73B0\u7684\u60C5\u51B5\u4E0B\u5077\u5077\u6E9C\u8FC7\u8499\u7740\u773C\u775B\u7684\u73A9\u5BB6\uFF08\u9B9F\u9C47\u9C7C\uFF09")),this._clueList.push(new O(0,"D_3","\u8FFD\u8E2A\u88C5\u7F6E","\u632A\u9EA6\u98DE\u8239\u5760\u6BC1\u5728\u9ED1\u8346\u7684\u6839\u90E8\u3002\u632A\u9EA6\u4EBA\u8BD5\u56FE\u5C06\u8FFD\u8E2A\u88C5\u7F6E\u63D2\u5165\u9ED1\u8346\u7684\u4E00\u6839\u85E4\u8513\u4E2D\uFF0C\u4EE5\u91CD\u65B0\u5B9A\u4F4D\u6839\u90E8\uFF0C\u4F46\u5B83\u4EEC\u65E0\u6CD5\u7A7F\u900F\u85E4\u8513\u575A\u786C\u7684\u5916\u8868")),this._clueList.push(new O(1,"TLD_1","\u65F6\u95F4\u5FAA\u73AF\u88C5\u7F6E","\u632A\u9EA6\u7814\u7A76\u4EBA\u5458\u5728\u6DF1\u5DE8\u661F\u5236\u9020\u51FA\u4E00\u4E2A\u5C0F\u578B\u4F46\u529F\u80FD\u6B63\u5E38\u7684\u65F6\u95F4\u5FAA\u73AF\u88C5\u7F6E\u540E\uFF0C\u8BA1\u5212\u5728\u7070\u70EC\u53CC\u661F\u4E0A\u5EFA\u9020\u4E00\u4E2A\u5B8C\u6574\u89C4\u6A21\u7684\u88C5\u7F6E\uFF08\u524D\u63D0\u662F\u80FD\u4EA7\u751F\u8DB3\u591F\u7684\u80FD\u91CF\u4E3A\u5176\u63D0\u4F9B\u52A8\u529B\uFF09")),this._clueList.push(new O(1,"TLD_2","\u8DC3\u8FC1\u5854","\u632A\u9EA6\u4EBA\u5EFA\u9020\u4E86\u7279\u6B8A\u7684\u5854\u697C\uFF0C\u53EF\u4EE5\u5C06\u5854\u5185\u7684\u4EFB\u4F55\u4EBA\u4F20\u9001\u5230\u76F8\u5E94\u7684\u63A5\u6536\u5E73\u53F0\u3002\u53EA\u6709\u5F53\u4F60\u80FD\u900F\u8FC7\u5854\u9876\u770B\u5230\u76EE\u7684\u5730\u65F6\uFF0C\u624D\u4F1A\u4F20\u9001")),this._clueList.push(new O(1,"TLD_3","\u5927\u5DE5\u7A0B",`\u632A\u9EA6\u4EBA\u6316\u6398\u4E86\u6C99\u6F0F\u53CC\u661F\uFF0C\u5EFA\u9020\u4E86\u4E00\u53F0\u80FD\u591F\u5229\u7528\u8D85\u65B0\u661F\u80FD\u91CF\u7684\u5DE8\u5927\u88C5\u7F6E

\u63A7\u5236\u4E2D\u5FC3\u4F4D\u4E8E\u884C\u661F\u4E2D\u5FC3\u7684\u4E00\u4E2A\u4E2D\u7A7A\u7A7A\u8154\u5185\uFF0C\u4E0E\u5730\u8868\u5B8C\u5168\u9694\u7EDD`))}init(){u.addObserver(this),this._isDead=!1}onReceiveGlobalMessage(e){e.id==="learn launch codes"&&!this._knowsLaunchCodes?(this._knowsLaunchCodes=!0,r.publish("\u5DF2\u83B7\u53D6\u53D1\u5C04\u5BC6\u7801",!0),u.sendMessage("spawn ship")):e.id==="learn signal coordinates"&&!this._knowsSignalCoordinates&&(this._knowsSignalCoordinates=!0,r.publish("\u5DF2\u83B7\u53D6\u4FE1\u53F7\u5750\u6807",!0)),y.saveData(this)}killPlayer(){this._isDead=!0,y.saveData(this)}isPlayerDead(){return this._isDead}isPlayerAtEOTU(){return c.player.currentSector==i._solarSystem.quantumMoon&&c.getQuantumMoonLocation()==4||c.player.currentSector==i._solarSystem.eyeOfTheUniverse}knowsFrequency(e){return this._knownFrequencies.includes(e)}knowsSignalCoordinates(){return this._knowsSignalCoordinates}learnFrequency(e){this.knowsFrequency(e)||(this._knownFrequencies.push(e),r.publish("\u9891\u7387\u5DF2\u8BC6\u522B: "+$(e),!0)),y.saveData(this)}getFrequencyCount(){return this._knownFrequencies.length}knowsLaunchCodes(){return this._knowsLaunchCodes}getClueAt(e){return this._clueList[e]}getClueCount(){return this._clueList.length}getKnownClueCount(){return this._knownClueCount}discoverClue(e){for(let t=0;t<this._clueList.length;t++)this._clueList[t].id===e&&!this._clueList[t].discovered&&(this._clueList[t].discovered=!0,this._knownClueCount++,r.publish("\u4FE1\u606F\u5DF2\u6DFB\u52A0\u81F3\u6570\u636E\u5E93",!0));y.saveData(this)}},O=class{constructor(e,t,o,n){this.invoked=!1;this.curiosity=e,this.id=t,this.name=o,this.description=n,this.discovered=dt}};var y=class{static{this.PLAYER_DATA="playerData"}static saveData(e){localStorage.setItem(this.PLAYER_DATA,JSON.stringify(e))}static loadData(){let e=new Z;if(!this.hasData())return e;let t=JSON.parse(localStorage.getItem(this.PLAYER_DATA));return Object.assign(e,t),e}static clearData(){localStorage.removeItem(this.PLAYER_DATA)}static hasData(){return!!localStorage.getItem(this.PLAYER_DATA)}};var ee=class extends m{constructor(){super(),y.hasData()?(this.addTitleButton("\u7EE7\u7EED",110),this.addTitleButton("\u91CD\u7F6E\u8FDB\u5EA6",-110)):this.addTitleButton("\u65B0\u6E38\u620F",0)}addTitleButton(e,t){this.addButton(new a(e,width/2+t,height-50,200,50))}onEnter(){if(mt){i.loadSector(3);return}A.play(W.kazooTheme)}onExit(){A.pause()}update(){}render(){fill(142,90,90),textAlign(CENTER,CENTER),textSize(100),text("Outer Wilds",width/2,height/2-50),fill(0,0,100),textSize(22),text("\u4E00\u573A\u60CA\u5FC3\u52A8\u9B44\u7684\u56FE\u5F62\u6587\u672C\u5192\u9669",width/2,height/2+50)}onButtonUp(e){e.id=="\u65B0\u6E38\u620F"||e.id=="\u7EE7\u7EED"?i.loadSector(3):e.id=="\u91CD\u7F6E\u8FDB\u5EA6"&&(y.clearData(),$e())}},te=class extends m{constructor(){super(),this.addButton(new a("\u9000\u51FA",width/2,height-50,200,50))}onEnter(){A.play(W.kazooTheme)}onExit(){A.pause()}update(){}render(){fill(142,90,90),textAlign(CENTER,CENTER),textSize(100),text("Outer Wilds",width/2,height/2-50),fill(0,0,100),textSize(22),text("\u611F\u8C22\u6E38\u73A9\uFF01",width/2,height/2+50)}onButtonUp(e){e.id=="\u9000\u51FA"&&$e()}};var x=class s extends m{static{this.BOX_WIDTH=700}static{this.BOX_HEIGHT=400}constructor(){super(),this.overlay=!0,this.initButtons()}initButtons(){this.addButtonToToolbar(this._nextButton=new a("\u7EE7\u7EED",0,0,150,50))}addDatabaseButton(){this.addButtonToToolbar(this._databaseButton=new a("\u67E5\u770B\u6570\u636E\u5E93",0,0,150,50))}addContinueButton(){this.addButtonToToolbar(this._nextButton=new a("\u7EE7\u7EED",0,0,150,50))}update(){}renderBackground(){}render(){push(),translate(width/2-s.BOX_WIDTH/2,height/2-s.BOX_HEIGHT/2),stroke(0,0,100),fill(0,0,0),rectMode(CORNER),rect(0,0,s.BOX_WIDTH,s.BOX_HEIGHT),fill(0,0,100),textFont(S),textSize(18),textAlign(LEFT,TOP),text(this.getDisplayText(),10,10,s.BOX_WIDTH-20,s.BOX_HEIGHT-20),pop(),r.render(),_.renderTimer()}onButtonUp(e){e==this._nextButton?this.onContinue():e==this._databaseButton&&(i.pushScreen(i.databaseScreen),i.databaseScreen.setObserver(this))}onInvokeClue(e){}onEnter(){}onExit(){}},oe=class extends x{onEnter(){r.clear(),r.publish("\u4F60\u88AB\u9B9F\u9C47\u9C7C\u5403\u6389\u4E86",!0)}getDisplayText(){return`\u4F60\u5728\u98DE\u5411\u95EA\u8000\u7684\u5149\u8292\u65F6\uFF0C\u7A81\u7136\u610F\u8BC6\u5230\u8FD9\u5B9E\u9645\u4E0A\u662F\u5DE8\u578B\u9B9F\u9C47\u9C7C\u7684\u8BF1\u9975\uFF01

\u4F60\u8BD5\u56FE\u626D\u5934\u5C31\u8DD1\uFF0C\u4F46\u4E3A\u65F6\u5DF2\u665A \u2014\u2014 \u9B9F\u9C47\u9C7C\u4E00\u53E3\u5C31\u628A\u4F60\u541E\u6CA1\u4E86

\u4E16\u754C\u53D8\u5F97\u4E00\u7247\u6F06\u9ED1...`}onContinue(){d.killPlayer()}},se=class extends x{onEnter(){r.clear(),r.publish("\u4F60\u5C1D\u8BD5\u6F5C\u5165\u6C34\u4E0B",!0)}getDisplayText(){return"\u4F60\u5C1D\u8BD5\u6F5C\u5165\u6C34\u4E0B\uFF0C\u4F46\u6D45\u5C42\u5F3A\u5927\u7684\u6C34\u6D41\u963B\u6B62\u4F60\u7EE7\u7EED\u6F5C\u5165\u51E0\u767E\u7C73\u4E0B\u7684\u6DF1\u6C34\u533A"}onContinue(){i.popScreen()}},ie=class extends x{constructor(e,t){super(),this._text=e,this._destination=t}onExit(){r.clear(),r.publish("\u4F60\u5DF2\u88AB\u4F20\u9001\u81F3\u65B0\u5730\u70B9",!0)}getDisplayText(){return this._text}onContinue(){i.popScreen(),u.sendMessage(new C("teleport to",this._destination))}},re=class extends x{constructor(e,t){super(),this._text=e,this._destination=t}getDisplayText(){return this._text}onContinue(){i.popScreen(),u.sendMessage(new C("move to",this._destination))}},ne=class extends x{constructor(e,t){super(),this._arrivalText=e,this._sectorName=t}onEnter(){r.clear(),r.publish("\u4F60\u5DF2\u62B5\u8FBE"+this._sectorName)}getDisplayText(){return this._arrivalText}onContinue(){i.popScreen()}},ae=class extends x{constructor(){super(...arguments);this._screenIndex=0;this._photoTaken=!1}initButtons(){this.addDatabaseButton(),this.addContinueButton()}getDisplayText(){return this._screenIndex==0?this._photoTaken?"\u5728\u5B83\u88AB\u9010\u6E10\u903C\u8FD1\u7684\u8FF7\u96FE\u5B8C\u5168\u906E\u6321\u4E4B\u524D\uFF0C\u4F60\u4F7F\u7528\u5C0F\u4FA6\u5BDF\u5175\u62CD\u6444\u4E86\u536B\u661F\u7684\u7167\u7247":"\u4F60\u63A5\u8FD1\u4E86\u91CF\u5B50\u536B\u661F, \u4E00\u56E2\u5947\u602A\u7684\u8FF7\u96FE\u5F00\u59CB\u906E\u6321\u4F60\u7684\u89C6\u7EBF...":this._screenIndex==1?this._photoTaken?`\u4F60\u4E00\u5934\u624E\u8FDB\u96FE\u4E2D\uFF0C\u786E\u4FDD\u81EA\u5DF1\u76EF\u7740\u521A\u521A\u62CD\u5230\u7684\u7167\u7247

\u7A81\u7136\uFF0C\u5DE8\u5927\u7684\u5F62\u72B6\u4ECE\u96FE\u4E2D\u6D6E\u73B0...\u4F60\u62B5\u8FBE\u4E86\u91CF\u5B50\u536B\u661F\u7684\u8868\u9762\uFF01`:`\u8FF7\u96FE\u5B8C\u5168\u541E\u6CA1\u4E86\u4F60\u7684\u98DE\u8239\uFF0C\u7136\u540E\u7A81\u7136\u6D88\u6563\uFF0C\u5C31\u50CF\u5B83\u51FA\u73B0\u65F6\u90A3\u6837

\u4F60\u73AF\u987E\u56DB\u5468\uFF0C\u91CF\u5B50\u536B\u661F\u5DF2\u7ECF\u795E\u79D8\u6D88\u5931\u4E86`:""}onInvokeClue(t){t.id==="QM_1"?(i.popScreen(),this._photoTaken=!0,this._databaseButton.enabled=!1):r.publish("\u90A3\u4E2A\u73B0\u5728\u8FD8\u4E0D\u80FD\u5E2E\u52A9\u5230\u4F60",!0)}onContinue(){this._screenIndex++,this._databaseButton.enabled=!1,this._screenIndex>1&&(this._photoTaken?i.popScreen():(i.popScreen(),u.sendMessage("quantum moon vanished")))}},le=class extends x{constructor(){super(),c.player.currentSector.getName()==="Quantum Moon"?this._displayText=`\u4F60\u5173\u95ED\u4E86\u624B\u7535\u7B52\uFF0C\u4E16\u754C\u53D8\u5F97\u4E00\u7247\u6F06\u9ED1

\u5F53\u4F60\u91CD\u65B0\u6253\u5F00\u624B\u7535\u7B52\u65F6\uFF0C\u56DB\u5468\u7684\u73AF\u5883\u53D1\u751F\u4E86\u53D8\u5316...`:this._displayText=`\u4F60\u722C\u4E0A\u4E86\u91CF\u5B50\u788E\u7247\u7684\u9876\u90E8\u5E76\u5173\u95ED\u4E86\u624B\u7535\u7B52\u3002\u73AF\u5883\u5B9E\u5728\u662F\u592A\u9ED1\u4E86\uFF0C\u4F38\u624B\u4E0D\u89C1\u4E94\u6307

\u5F53\u4F60\u91CD\u65B0\u6253\u5F00\u624B\u7535\u7B52\u65F6\uFF0C\u4F60\u4ECD\u7136\u7AD9\u5728\u91CF\u5B50\u788E\u7247\u7684\u9876\u90E8\uFF0C\u4F46\u56DB\u5468\u7684\u73AF\u5883\u53D1\u751F\u4E86\u53D8\u5316...`}onEnter(){r.clear(),r.publish("\u4F60\u4E0E\u91CF\u5B50\u7269\u4F53\u4E00\u5757\u53D1\u751F\u7EA0\u7F20\u73B0\u8C61\u4E86")}getDisplayText(){return this._displayText}onContinue(){i.popScreen()}},ue=class extends x{constructor(){super(...arguments);this._screenIndex=0;this._silentRunning=!1}initButtons(){this.addDatabaseButton(),this.addContinueButton()}getDisplayText(){return this._screenIndex==0?`\u4F60\u5411\u5176\u4E2D\u4E00\u6735\u602A\u5F02\u7684\u84DD\u8272\u82B1\u6735\u53D1\u5C04\u5C0F\u4FA6\u5BDF\u5175\uFF0C\u5B83\u5F88\u5FEB\u5C31\u88AB\u541E\u566C\u4E86\u3002\u4F60\u8DDF\u968F\u5C0F\u4FA6\u5BDF\u5175\u7684\u8FFD\u8E2A\u4FE1\u53F7\uFF0C\u987A\u7740\u9519\u7EFC\u590D\u6742\u7684\u85E4\u8513\u8FDB\u5165\u9ED1\u8346\u661F\u7684\u4E2D\u5FC3\u6DF1\u5904

\u4F60\u5982\u6B64\u4E13\u6CE8\u4E8E\u8DDF\u968F\u5C0F\u4FA6\u5BDF\u5175\u7684\u4FE1\u53F7\uFF0C\u4EE5\u81F3\u4E8E\u4F60\u6CA1\u6709\u6CE8\u610F\u5230\u53D1\u5149\u7684\u8BF1\u9975\uFF0C\u4F46\u5DF2\u4E3A\u65F6\u5DF2\u665A\u3002\u4F60\u76F4\u63A5\u98DE\u8FDB\u4E86\u9B9F\u9C47\u9C7C\u7684\u5DE2\u7A74\u91CC\uFF01`:this._screenIndex==1?this._silentRunning?`\u4F60\u7A81\u7136\u60F3\u8D77\u4E86\u90A3\u4E2A\u53E4\u8001\u513F\u7AE5\u6E38\u620F\u7684\u89C4\u5219\uFF0C\u4F60\u5173\u6389\u4E86\u5F15\u64CE\uFF0C\u6084\u6084\u5730\u6F02\u8FDB\u4E86\u5DE2\u7A74

\u4F3C\u4E4E\u6CA1\u6709\u9B9F\u9C47\u9C7C\u6CE8\u610F\u5230\u4F60\uFF0C\u4F60\u5B89\u5168\u5730\u5230\u8FBE\u4E86\u53E6\u4E00\u8FB9\u3002\u4F60\u7EE7\u7EED\u8DDF\u968F\u5C0F\u4FA6\u5BDF\u5175\u7684\u4FE1\u53F7\u524D\u8FDB\uFF0C\u6CA1\u8FC7\u591A\u4E45\uFF0C\u4F60\u5230\u8FBE\u4E86\u4E00\u4E2A\u7EA0\u7F20\u4E8E\u9ED1\u8346\u6839\u90E8\u7684\u53E4\u8001\u9057\u8FF9`:"\u4F60\u53CD\u8F6C\u4E86\u98DE\u8239\u7684\u63A8\u8FDB\u5668\uFF0C\u4F46\u4E3A\u65F6\u5DF2\u665A\u3002\u9B9F\u9C47\u9C7C\u98DE\u901F\u731B\u6251\u8FC7\u6765\uFF0C\u541E\u566C\u4E86\u6574\u4E2A\u98DE\u8239":""}onButtonUp(t){t==this._nextButton?this.onContinue():t==this._databaseButton&&(i.pushScreen(i.databaseScreen),i.databaseScreen.setObserver(this))}onInvokeClue(t){t.id==="D_2"?(i.popScreen(),this._silentRunning=!0,this._screenIndex++,this._databaseButton.enabled=!1):r.publish("\u90A3\u4E2A\u73B0\u5728\u8FD8\u4E0D\u80FD\u5E2E\u52A9\u5230\u4F60",!0)}onContinue(){this._screenIndex++,this._databaseButton.enabled=!1,this._screenIndex>1&&(this._silentRunning?(i.popScreen(),u.sendMessage(new C("move to","\u53E4\u98DE\u8239"))):(i.popScreen(),d.killPlayer()))}},he=class extends x{constructor(){super(),this._displayText=`\u4F60\u63A2\u7D22\u4E86\u8FD9\u7247\u5E9F\u589F\uFF0C\u6700\u7EC8\u627E\u5230\u4E86\u8FD9\u91CC\u3002\u5C3D\u7BA1\u98DE\u8239\u7684\u751F\u547D\u7EF4\u6301\u7CFB\u7EDF\u5DF2\u7ECF\u5931\u6548\uFF0C\u4F46\u4E00\u4E9B\u8BA1\u7B97\u673A\u7EC8\u7AEF\u4ECD\u5728\u4F7F\u7528\u67D0\u79CD\u8F85\u52A9\u7535\u6E90\u8FD0\u884C\u3002\u4F60\u627E\u5230\u4E86\u632A\u9EA6\u4EBA\u4ECE\u5B87\u5B99\u4E4B\u773C\u63A5\u6536\u7684\u539F\u59CB\u4FE1\u53F7\u7684\u8BB0\u5F55\u3002\u6839\u636E\u5B83\u4EEC\u7684\u5206\u6790\uFF0C\u65E0\u8BBA\u4FE1\u53F7\u6765\u81EA\u4EC0\u4E48\u7269\u4F53\uFF0C\u90FD\u6BD4\u5B87\u5B99\u672C\u8EAB\u66F4\u4E3A\u53E4\u8001\uFF01

\u4F60\u53C8\u56DB\u5904\u63A2\u67E5\u4E86\u4E00\u756A\uFF0C\u53D1\u73B0\u8FD9\u8258\u8239\u7684\u8DC3\u8FC1\u88C5\u7F6E\u5728\u51E0\u767E\u5E74\u524D\u5C31\u5B8C\u6210\u4E86\u5145\u80FD`}initButtons(){this.addButtonToToolbar(this._warpButton=new a("\u4F7F\u7528\u8DC3\u8FC1\u88C5\u7F6E",0,0,150,50)),super.initButtons()}getDisplayText(){return this._displayText}onButtonUp(e){e==this._warpButton?d.knowsSignalCoordinates()?_.getEnabled()?this._displayText="\u4F60\u8F93\u5165\u4E86\u5B87\u5B99\u4E4B\u773C\u7684\u5750\u6807\u5E76\u5C1D\u8BD5\u4F7F\u7528\u8DC3\u8FC1\u88C5\u7F6E\uFF0C\u4F46\u7531\u4E8E\u5B58\u5728\u201C\u5DE8\u5927\u7684\u65F6\u95F4\u626D\u66F2\u201D\uFF0C\u5B83\u62D2\u7EDD\u542F\u52A8'.":(i.popScreen(),u.sendMessage(new C("teleport to","Ancient Vessel 2")),r.clear(),r.publish("\u53E4\u98DE\u8239\u8DC3\u8FC1\u5230\u4E86\u5B87\u5B99\u4E4B\u773C\u6240\u5728\u7684\u5750\u6807")):this._displayText="\u4F60\u8BD5\u56FE\u4F7F\u7528\u8DC3\u8FC1\u88C5\u7F6E\uFF0C\u4F46\u6CA1\u6709\u76EE\u7684\u5730\u5750\u6807\uFF0C\u88C5\u7F6E\u663E\u7136\u65E0\u6CD5\u542F\u52A8":e==this._nextButton&&this.onContinue()}onContinue(){i.popScreen()}},de=class extends x{constructor(){super(...arguments);this._screenIndex=0}initButtons(){this.addContinueButton()}getDisplayText(){return this._screenIndex==0?`\u4F60\u6B63\u4F4D\u4E8E\u7070\u70EC\u53CC\u661F\u4E2D\u5FC3\u7684\u4E00\u4E2A\u5DE8\u5927\u7403\u5F62\u8231\u5185\u3002\u4F60\u5728\u5916\u9762\u770B\u5230\u7684\u4E24\u6839\u5DE8\u578B\u5929\u7EBF\u5EF6\u4F38\u5230\u4E86\u5730\u8868\u4EE5\u4E0B\uFF0C\u5E76\u6C47\u805A\u5230\u4E86\u5BC6\u5BA4\u4E2D\u5FC3\u4E00\u4E2A\u7CBE\u5FC3\u5236\u4F5C\u7684\u7EBF\u5708\u72B6\u7684\u632A\u9EA6\u79D1\u6280\u88C5\u7F6E\u4E2D\u3002\u8FD9\u4E00\u5B9A\u5C31\u662F\u65F6\u95F4\u5FAA\u73AF\u7684\u6E90\u5934\uFF01

\u4F60\u53D1\u73B0\u4E86\u4E00\u4E2A\u4FE1\u53F7\u53D1\u5C04\u5668\uFF0C\u5B83\u80FD\u81EA\u52A8\u901A\u77E5\u6DF1\u5DE8\u661F\u8F68\u9053\u4E0A\u7684\u632A\u9EA6\u7A7A\u95F4\u7AD9\u5728\u6BCF\u6B21\u5FAA\u73AF\u5F00\u59CB\u65F6\u53D1\u5C04\u4E00\u4E2A\u63A2\u6D4B\u5668

\u65F6\u95F4\u5FAA\u73AF\u88C5\u7F6E\u9700\u8981\u8D85\u65B0\u661F\u7684\u80FD\u91CF\u6765\u6539\u53D8\u65F6\u95F4\u7684\u6D41\u901D\u3002\u51E0\u5343\u5E74\u524D\uFF0C\u632A\u9EA6\u4EBA\u66FE\u8BD5\u4EBA\u5DE5\u6FC0\u53D1\u8D85\u65B0\u661F\uFF0C\u4F46\u6CA1\u6709\u6210\u529F`:`\u4F60\u6700\u7EC8\u627E\u5230\u4E86\u901A\u5F80\u5BC6\u5BA4\u4E2D\u5FC3\u7684\u8DEF\uFF0C\u5E76\u627E\u5230\u4E86\u770B\u8D77\u6765\u50CF\u662F\u65F6\u95F4\u5FAA\u73AF\u673A\u5668\u7684\u754C\u9762

\u4F60\u60F3\u5173\u95ED\u65F6\u95F4\u5FAA\u73AF\u5417\uFF1F`}onButtonUp(t){super.onButtonUp(t),t==this._yes?(u.sendMessage("\u5173\u95ED\u65F6\u95F4\u5FAA\u73AF"),i.popScreen()):t==this._no&&i.popScreen()}onContinue(){this._screenIndex++,this.removeButtonFromToolbar(this._nextButton),this.addButtonToToolbar(this._yes=new a("\u662F")),this.addButtonToToolbar(this._no=new a("\u5426"))}},ce=class extends x{constructor(){super(...arguments);this._screenIndex=0}getDisplayText(){return this._screenIndex==0?`\u5F53\u4F60\u9760\u8FD1\u56F4\u7ED5\u7740\u5B87\u5B99\u4E4B\u773C\u7684\u5947\u7279\u80FD\u91CF\u4E91\u65F6\uFF0C\u4F60\u770B\u5230\u6700\u540E\u51E0\u9897\u6052\u661F\u5728\u8FDC\u5904\u7206\u53D1\u3002\u5B87\u5B99\u53D8\u6210\u4E86\u4E00\u7247\u6F06\u9ED1\u7684\u865A\u65E0

\u5F53\u4F60\u5230\u8FBE\u4E91\u5C42\u4E2D\u5FC3\u65F6\uFF0C\u4E91\u5C42\u9010\u6E10\u6D88\u6563\uFF0C\u9732\u51FA\u4E00\u4E2A\u6F02\u6D6E\u5728\u7A7A\u4E2D\u7684\u5947\u7279\u7403\u5F62\u7269\u4F53\u3002\u5728\u5B83\u95EA\u95EA\u53D1\u5149\u7684\u8868\u9762\u4E0A\uFF0C\u4F60\u770B\u5230\u4E86\u6570\u5341\u4EBF\u4E2A\u5149\u70B9\u3002\u5F53\u4F60\u9760\u8FD1\u65F6\uFF0C\u4F60\u53D1\u73B0\u8FD9\u4E9B\u5149\u70B9\u50CF\u662F\u6052\u661F\u548C\u661F\u7CFB\u56E2\u3002\u6BCF\u5F53\u4F60\u628A\u76EE\u5149\u4ECE\u7403\u4F53\u4E0A\u79FB\u5F00\uFF0C\u518D\u79FB\u56DE\u6765\u65F6\uFF0C\u6052\u661F\u548C\u661F\u7CFB\u7684\u7ED3\u6784\u5C31\u4F1A\u53D1\u751F\u53D8\u5316

\u4F60\u542F\u52A8\u4E86\u55B7\u6C14\u80CC\u5305\uFF0C\u8FDB\u5165\u4E86\u7403\u4F53...`:`\u6709\u90A3\u4E48\u4E00\u77AC\u95F4\uFF0C\u4F60\u53D1\u73B0\u81EA\u5DF1\u6F02\u6D6E\u5728\u661F\u8FB0\u548C\u94F6\u6CB3\u7684\u6D77\u6D0B\u4E2D\u3002\u7A81\u7136\uFF0C\u6240\u6709\u7684\u6052\u661F\u90FD\u574D\u7F29\u6210\u4F60\u6B63\u524D\u65B9\u7684\u4E00\u4E2A\u5149\u70B9\u3002\u524D\u51E0\u79D2\u4EC0\u4E48\u90FD\u6CA1\u6709\u53D1\u751F\uFF0C\u7136\u540E\u5149\u70B9\u7A81\u7136\u5411\u5916\u7206\u53D1\u51FA\u60CA\u4EBA\u7684\u80FD\u91CF\u3002\u51B2\u51FB\u6CE2\u5C06\u4F60\u731B\u70C8\u649E\u5411\u4E86\u7A7A\u4E2D

\u4F60\u7684\u751F\u547D\u7EF4\u6301\u7CFB\u7EDF\u6B63\u5728\u5D29\u6E83\uFF0C\u800C\u4F60\u53EA\u80FD\u773C\u7741\u7741\u5730\u770B\u7740\u80FD\u91CF\u4E0E\u7269\u8D28\u56DB\u5411\u55B7\u5411\u592A\u7A7A

\u8FC7\u4E86\u4E00\u4F1A\uFF0C\u4F60\u7684\u89C6\u91CE\u6B63\u5728\u9010\u6E10\u53D8\u9ED1`}onContinue(){this._screenIndex++,this._screenIndex==2&&(i._solarSystem.player.currentSector=null,i.pushScreen(new te))}},pe=class extends x{constructor(){super(...arguments);this._screenIndex=0}initButtons(){this.addDatabaseButton(),this.addButtonToToolbar(this._yes=new a("\u662F")),this.addButtonToToolbar(this._no=new a("\u5426"))}getDisplayText(){return this._screenIndex==0?`\u4F60\u6B63\u5728\u63A2\u7D22\u9ED1\u8346\u661F\u7684\u5916\u56F4\uFF0C\u85E4\u8513\u7684\u9876\u7AEF\u4F1A\u5F00\u51FA\u5DE8\u5927\u7684\u5F02\u5F62\u767D\u82B1\uFF08\u4EE5\u53CA\u51E0\u6735\u84DD\u82B1\uFF09

\u4F60\u6CE8\u610F\u5230\u9760\u8FD1\u6BCF\u6735\u82B1\u4E2D\u5FC3\u7684\u5730\u65B9\u90FD\u6709\u4E00\u4E2A\u5C0F\u5F00\u53E3...\u4F60\u60F3\u9760\u8FD1\u4ED4\u7EC6\u770B\u770B\u5417\uFF1F`:`\u5F53\u4F60\u9760\u8FD1\u65F6\uFF0C\u82B1\u6735\u6253\u5F00\u4E86\uFF0C\u4E00\u80A1\u5947\u602A\u7684\u529B\u91CF\u5F00\u59CB\u628A\u4F60\u63A8\u8FDB\u53BB\u3002\u4F60\u62FC\u547D\u60F3\u9003\u79BB\uFF0C\u4F46\u6CA1\u6709\u7528

\u4F60\u88AB\u4E00\u6735\u5DE8\u5927\u7684\u82B1\u6735\u6BEB\u4E0D\u7559\u60C5\u5730\u541E\u566C\u4E86\u3002\u4E16\u754C\u4E00\u7247\u6F06\u9ED1\uFF0C\u4F60\u80FD\u542C\u5230\u81EA\u5DF1\u88AB\u6D88\u5316\u7684\u58F0\u97F3...`}onButtonUp(t){super.onButtonUp(t),t==this._yes?(this._screenIndex++,this.removeButtonFromToolbar(this._yes),this.removeButtonFromToolbar(this._no),this.removeButtonFromToolbar(this._databaseButton),this.addContinueButton()):t==this._no&&i.popScreen()}onInvokeClue(t){t.id==="D_3"?(i.popScreen(),u.sendMessage("follow the vine")):r.publish("\u90A3\u4E2A\u73B0\u5728\u8FD8\u4E0D\u80FD\u5E2E\u52A9\u5230\u4F60",!0)}onContinue(){d.killPlayer()}};var _e=class{constructor(){this._skipRender=!1;this._screenStack=new Array}lateUpdate(){}runGameLoop(){if(this._screenStack.length>0){this._skipRender=!1;let e=this._screenStack[this._screenStack.length-1];if(e.updateInput(),e.update(),this.lateUpdate(),this._skipRender)return;let t=0;for(let o=this._screenStack.length-1;o>=0;o--)if(!this._screenStack[o].overlay){t=o;break}for(let o=t;o<this._screenStack.length;o++)this._screenStack[o].renderBackground(),this._screenStack[o].renderButtons(),this._screenStack[o].render()}else p("No screens on the stack!!!")}swapScreen(e){this._screenStack.length>0&&(this._screenStack[this._screenStack.length-1].onExit(),this._screenStack[this._screenStack.length-1].active=!1,this._screenStack.splice(this._screenStack.length-1,1)),this._screenStack.push(e),this._screenStack[this._screenStack.length-1].active=!0,this._screenStack[this._screenStack.length-1].onEnter(),this._skipRender=!0,p("SWAP:",e)}pushScreen(e){this._screenStack.length>0&&(this._screenStack[this._screenStack.length-1].onExit(),this._screenStack[this._screenStack.length-1].active=!1),this._screenStack.push(e),e.active=!0,e.onEnter(),this._skipRender=!0,p("PUSH:",e)}popScreen(){this._screenStack[this._screenStack.length-1].onExit(),this._screenStack[this._screenStack.length-1].active=!1,this._screenStack.splice(this._screenStack.length-1,1),this._screenStack.length>0&&(this._screenStack[this._screenStack.length-1].active=!0,this._screenStack[this._screenStack.length-1].onEnter()),this._skipRender=!0,p("POP")}};var me=class{constructor(e,t){this._node=e,this._nodeObj=t}parseJSON(){this._exploreString=this._nodeObj.getString("explore","Nothing to see here!"),this._exploreArray=new I,this._exploreString.charAt(0)=="{"?this._activeExploreObj=this._nodeObj.getJSONObject("explore"):this._exploreString.charAt(0)=="["&&(this._exploreArray=this._nodeObj.getJSONArray("explore"),this._activeExploreObj=this._exploreArray.getJSONObject(0)),this._dirty=!0}updateActiveExploreData(){for(let e=0;e<this._exploreArray.size();e++){let t=this._exploreArray.getJSONObject(e),o=t.getInt("turn cycle",1),n=_.getActionPoints()%o;t.getInt("on turn",-1)==n&&t!=this._activeExploreObj&&(this._activeExploreObj=t,this._dirty=!0)}}canClueBeInvoked(e){if(e==="QM_2"&&this._node.allowQuantumEntanglement())return!0;for(let t=0;t<this._exploreArray.size();t++){let o=this._exploreArray.getJSONObject(t);if(o.getString("require clue","")===e&&o!=this._activeExploreObj||o.hasKey("clue event")&&o.getJSONObject("clue event").getString("clue id")===e)return!0}return!1}invokeClue(e){e==="QM_2"&&this._node.allowQuantumEntanglement()&&(i.popScreen(),u.sendMessage("quantum entanglement"));for(let t=0;t<this._exploreArray.size();t++){let o=this._exploreArray.getJSONObject(t);if(o.getString("require clue","")===e&&o!=this._activeExploreObj&&(this._activeExploreObj=o,this._dirty=!0),o.hasKey("clue event")&&o.getJSONObject("clue event").getString("clue id")===e){let l=o.getJSONObject("clue event").getString("event id");u.sendMessage(l)}}}explore(){this.updateActiveExploreData(),this._dirty&&this._activeExploreObj!=null&&(this.fireEvents(this._activeExploreObj),this.discoverClues(this._activeExploreObj),this.revealHiddenPaths(this._activeExploreObj),this._dirty=!1)}fireEvents(e){e.hasKey("fire event")&&u.sendMessage(e.getString("fire event")),e.hasKey("move to")&&i.swapScreen(new re(e.getString("text"),e.getString("move to"))),e.hasKey("teleport to")&&i.swapScreen(new ie(e.getString("text"),e.getString("teleport to")))}discoverClues(e){e.hasKey("discover clue")&&d.discoverClue(e.getString("discover clue"))}revealHiddenPaths(e){if(e.hasKey("reveal paths")){let t=e.getJSONArray("reveal paths");for(let o=0;o<t.size();o++)this._node.getConnection(t.getString(o)).revealHidden();r.publish("\u4F60\u53D1\u73B0\u4E86\u4E00\u6761\u9690\u85CF\u901A\u9053\uFF01",!0)}}getExploreText(){return this._activeExploreObj!=null?this._activeExploreObj.getString("text","no explore text"):this._exploreString}};var D=class extends a{constructor(t){super("\u5207\u6362\u9891\u7387",width/2+140,40,50,50);this._rightFacing=!0;this._rightFacing=t,t||this.setScreenPosition(new h(width/2-140,40))}drawShape(){push(),translate(this.screenPosition.x,this.screenPosition.y),this._rightFacing?triangle(25,0,0,15,0,-15):triangle(-25,0,0,15,0,-15),pop()}drawText(t){}},be=class{constructor(){this._frequency=2}update(e){this._signalStrength=0;for(let t=0;t<e.length;t++)this._signalStrength+=e[t].getSignalStrength(new h(mouseX,mouseY),this._frequency)}render(){let e=$(this._frequency);d.knowsFrequency(this._frequency)||(this._frequency==0?e="\u672A\u77E5\u9891\u7387 001":this._frequency==1&&(e="\u672A\u77E5\u9891\u7387 002"));let t=width/2;fill(0,0,100),textSize(18),textFont(S),text(e,t,40),textFont(E),stroke(0,0,100),fill(200,100,100),rectMode(CENTER),rect(t,70,max(0,this._signalStrength*300-random(50)),7),noFill(),stroke(0,0,100),line(mouseX,0,mouseX,height),line(0,mouseY,width,mouseY)}nextFrequency(){let e=(this._frequency+1)%this.getFrequencyValues().length;this._frequency=this.getFrequencyValues()[e]}previousFrequency(){let e=this._frequency-1;e<0&&(e=this.getFrequencyValues().length-1),this._frequency=this.getFrequencyValues()[e]}getFrequencyValues(){return Object.values(j).filter(e=>typeof e=="number")}},B=class extends f{constructor(e,t){super(),e instanceof g?(this.setScreenPosition(e.screenPosition),this._signals=new Array,this._signals.push(e.getSignal())):(this.setScreenPosition(e),this._signals=t.getSectorSignals())}addSignal(e){this._signals.push(e)}getSignalStrength(e,t){if(this.hasSignalWithFrequency(t)){let n=e.sub(this.screenPosition).magnitude(),l=max(0,1-n/150);return l*l*l}return 0}hasSignalWithFrequency(e){for(let t=0;t<this._signals.length;t++)if(this._signals[t].frequency==e)return!0;return!1}},ge=class{constructor(e){this.frequency=0;e==="QUANTUM"?this.frequency=1:e==="BEACON"?this.frequency=0:e==="TRAVELER"&&(this.frequency=2)}};var g=class s extends f{constructor(t,o){super(typeof t=="number"?t:0,typeof o=="number"?o:0);this._id="";this._name="";this.entryPoint=!1;this.shipAccess=!1;this.allowTelescope=!0;this.gravity=!0;this._signal=null;this._visible=!1;this._visited=!1;this._explored=!1;this._inRange=!1;this._button=null;this._observer=null;this._nodeJSONObj=null;this._exploreData=null;this._connections=new Map,this._observers=new Array,u.addObserver(this),typeof t=="string"&&typeof o!="number"&&(this._id=t,this._name=t,this.loadJSON(o),this.entryPoint&&(this._visible=!0),this._button=new a(this._id,0,0,this.getSize()*1.5,this.getSize()*1.5),this._button.setObserver(this),this._button.visible=!1,this.addChild(this._button))}loadJSON(t){this._nodeJSONObj=t,this._name=this._nodeJSONObj.getString("name",this._id),t.hasKey("explore")&&(this._exploreData=new me(this,t)),this.position.x=this._nodeJSONObj.getJSONObject("position").getFloat("x"),this.position.y=this._nodeJSONObj.getJSONObject("position").getFloat("y"),this._visible=this._nodeJSONObj.getBoolean("start visible",this._visible),L&&(this._visible=!0),this.entryPoint=this._nodeJSONObj.getBoolean("entry point",this.entryPoint),this.shipAccess=this.entryPoint||this._nodeJSONObj.getBoolean("ship access",this.shipAccess),this.allowTelescope=this._nodeJSONObj.getBoolean("allow telescope",this.allowTelescope),this.gravity=this._nodeJSONObj.getBoolean("gravity",this.gravity),this._nodeJSONObj.hasKey("signal")&&(this._signal=new ge(this._nodeJSONObj.getString("signal")))}savePosition(){this._nodeJSONObj.getJSONObject("position").setFloat("x",this.position.x),this._nodeJSONObj.getJSONObject("position").setFloat("y",this.position.y),p(this._id+" position saved:",this.position)}onReceiveGlobalMessage(t){}isExplorable(){return this._nodeJSONObj!=null&&this._nodeJSONObj.hasKey("explore")}getExploreData(){return this._exploreData}getProbeDescription(){return this._nodeJSONObj.hasKey("probe description")?this._nodeJSONObj.getString("probe description"):this.getDescription()}getDescription(){return this._nodeJSONObj.getString("description","a vast expanse of nothing")}hasDescription(){return this._nodeJSONObj!=null&&this._nodeJSONObj.hasKey("description")}isProbeable(){return this._nodeJSONObj!=null&&this._nodeJSONObj.hasKey("description")}isConnectedTo(t){return this._connections.has(t)}inRange(){return this._inRange}updateInRange(t,o){this._inRange=!1,o==this&&(this._inRange=!0),this.entryPoint&&t&&(this._inRange=!0),o!=null&&this.isConnectedTo(o)&&(this._inRange=!0)}getConnection(t){if(t instanceof s)return this._connections.get(t);for(let o of this._connections.keys())if(o.getID()===t)return this.getConnection(o);return null}allowQuantumEntanglement(){return this._nodeJSONObj==null?!1:this._nodeJSONObj.getBoolean("entanglement node",!1)}getSignal(){return this._signal}getID(){return this._id}getActualName(){return this._name}getKnownName(){return this._visited?this.getActualName():"???"}setVisible(t){this._visible=t}visit(){this._visited=!0,this.setVisible(!0),this._nodeJSONObj!=null&&this._nodeJSONObj.hasKey("fire event")&&u.sendMessage(this._nodeJSONObj.getString("fire event"));for(let t of this._connections.values())t.reveal();this._observer!=null&&this._observer.onNodeVisited(this)}explore(){this._explored=!0,this._exploreData.explore(),this._signal!=null&&d.learnFrequency(this._signal.frequency)}update(){this._visible&&(this._button.enabled=this.inRange()||L,this._button.update())}getAlpha(){return this.inRange()?100:35}getSize(){return this.entryPoint?50:this.isExplorable()?35:25}draw(){if(this._visible){if(this._button.hoverState?stroke(200,100,100,this.getAlpha()):stroke(0,0,100,this.getAlpha()),push(),translate(this.screenPosition.x,this.screenPosition.y),!this.isExplorable()){fill(0,0,0),ellipse(0,0,this.getSize(),this.getSize()),pop();return}this.entryPoint?(fill(0,0,0),ellipse(0,0,this.getSize(),this.getSize())):(fill(0,0,0),rect(0,0,this.getSize(),this.getSize())),this._explored||(fill(0,0,100,this.getAlpha()),textAlign(CENTER,CENTER),textSize(30),text("?",0,0)),pop()}}drawName(){if(!this._visible||!this.isExplorable())return;let t=new h(this.screenPosition.x,this.screenPosition.y-this.getSize()/2-20);noStroke(),fill(0,0,0),textSize(ot),rect(t.x,t.y,textWidth(this.getKnownName()),ot+4),fill(0,0,100,this.getAlpha()),textAlign(CENTER,CENTER),text(this.getKnownName(),t.x,t.y)}addConnection(t){if([...this._connections.values()].includes(t)){p("These nodes are already connected!!!");return}t.node1!=this?this._connections.set(t.node1,t):this._connections.set(t.node2,t)}setNodeObserver(t){this._observer=t}addObserver(t){this._observers.push(t)}removeAllObservers(){this._observers.length=0}onButtonUp(t){for(let o=0;o<this._observers.length;o++)this._observers[o].onNodeSelected(this)}onButtonEnterHover(t){for(let o=0;o<this._observers.length;o++)this._observers[o].onNodeGainFocus(this)}onButtonExitHover(t){for(let o=0;o<this._observers.length;o++)this._observers[o].onNodeLoseFocus(this)}};var fe=class{constructor(e,t,o){this._hasDescription=!1;this._adjacentToPlayer=!1;this._traversed=!1;this._visible=!1;this._gated=!1;this._oneWay=!1;this._hidden=!1;this.node1=e,this.node2=t,this._connectionObj=o,this.node1.addConnection(this),this.node2.addConnection(this),this._oneWay=o.getBoolean("one-way",this._oneWay),this._hidden=o.getBoolean("hidden",this._hidden),this._gated=o.getBoolean("gated",this._gated),L&&(this._visible=!0),o.hasKey("description")&&(this._hasDescription=!0,this._description=o.getString("description"))}updateAdjacentToPlayer(e){this._adjacentToPlayer=!1,(this.node1==e||this.node2==e)&&(this._adjacentToPlayer=!0)}hasDescription(){return this._hasDescription}getDescription(){return this._description}getWrongWayText(){return"\u770B\u8D77\u6765\u8FD9\u6761\u8DEF\u53EA\u80FD\u4ECE\u53E6\u4E00\u4FA7\u624D\u80FD\u901A\u884C"}getOtherNode(e){return e==this.node1?this.node2:this.node1}traversibleFrom(e){return!this._gated&&(!this._oneWay||e==this.node1)}fireTraverseEvent(){this._connectionObj.hasKey("traverse event")&&u.sendMessage(this._connectionObj.getString("traverse event"))}fireFailEvent(){this._connectionObj.hasKey("fail event")&&u.sendMessage(this._connectionObj.getString("fail event"))}traverse(){this._traversed=!0}revealHidden(){this._hidden=!1,this.reveal()}setVisible(e){this._visible=e}reveal(){this._hidden||(this.node1.setVisible(!0),this.node2.setVisible(!0),this._visible=!0)}getAlpha(){return this._adjacentToPlayer?100:35}render(){if(!this._visible)return;let e=this.node2.screenPosition.sub(this.node1.screenPosition),t=e.magnitude();if(e.normalize(),this._traversed)stroke(0,0,100,this.getAlpha()),line(this.node1.screenPosition.x,this.node1.screenPosition.y,this.node2.screenPosition.x,this.node2.screenPosition.y);else{stroke(0,0,100,this.getAlpha());let P=0,R=5;for(;P<t;){let v=this.node1.screenPosition.add(e.mult(P)),w=this.node1.screenPosition.add(e.mult(P+R));line(v.x,v.y,w.x,w.y),P+=R*3}}if(!this._oneWay)return;let o=this.node1.screenPosition.add(e.mult(t*.6)),n=o.sub(e.mult(14)),l=n.add(e.rightNormal().scale(7)),b=n.add(e.leftNormal().scale(7));fill(0,0,0),triangle(l.x,l.y,b.x,b.y,o.x,o.y)}};var N=class{constructor(){this._name="unnamed";this._skipArrivalScreen=!1;this.defaultActorPosition=new h(width-100,height-100);this._sectorRoot=new f(width/2,height/2),this._actors=new Array,this._nodes=new Array,this._nodeConnections=new Array,this.orbitNode=new g(80,170),this.orbitNode.gravity=!1,u.addObserver(this)}setAnchorOffset(e,t){this._sectorRoot.setPosition(width/2+e,height/2+t)}loadFromJSON(e){this._JSONFilename=e,this._sectorJSON=lt(e);let t=this._sectorJSON.getJSONObject("Nodes");for(let n of t.keys())this.addNode(this.createNode(n,t.getJSONObject(n)));let o=this._sectorJSON.getJSONArray("Connections");for(let n=0;n<o.size();n++){let l=o.getJSONObject(n),b=this.getNode(l.getString("Node 1")),P=this.getNode(l.getString("Node 2"));this._nodeConnections.push(new fe(b,P,l))}}createNode(e,t){return new g(e,t)}saveSectorJSON(){ut(this._sectorJSON,"data/"+this._JSONFilename),p("Sector JSON saved")}load(){}drawSectorBackdrop(){}onReceiveGlobalMessage(e){e.id==="quantum entanglement"&&this.onQuantumEntanglement()}onNodeVisited(e){this.updateNodeRanges(i._solarSystem.isPlayerInShip(),e)}onArrival(){!this._skipArrivalScreen&&this._sectorJSON.hasKey("Sector Arrival")&&(this._skipArrivalScreen=!0,i.pushScreen(new ne(this._sectorJSON.getJSONObject("Sector Arrival").getString("text"),this.getName())))}onQuantumEntanglement(){if(c.player.currentSector==this){i.pushScreen(new le);for(let e=0;e<this._nodes.length;e++)if(this._nodes[e].allowQuantumEntanglement()&&this._nodes[e]!=c.player.currentNode){c.player.setNode(this._nodes[e]);break}}}canClueBeInvoked(e){return!1}invokeClue(e){}updateNodeRanges(e,t){for(let o=0;o<this._nodes.length;o++)this._nodes[o].updateInRange(e,t);for(let o=0;o<this._nodeConnections.length;o++)this._nodeConnections[o].updateAdjacentToPlayer(t)}allowTelescope(){return!0}getName(){return this._name}getNode(e){if(typeof e=="number")return this._nodes[e]?this._nodes[e]:(p("No nodes at index "+e),null);for(let t=0;t<this._nodes.length;t++)if(this._nodes[t].getID()===e)return this._nodes[t];return null}getSectorSignalSources(){let e=new Array;for(let t=0;t<this._nodes.length;t++)this._nodes[t].getSignal()!=null&&e.push(new B(this._nodes[t]));return e}getSectorSignals(){let e=new Array;for(let t=0;t<this._nodes.length;t++)this._nodes[t].getSignal()!=null&&e.push(this._nodes[t].getSignal());return e}addNodeButtonObserver(e){for(let t=0;t<this._nodes.length;t++)this._nodes[t].addObserver(e)}removeAllNodeButtonObservers(){for(let e=0;e<this._nodes.length;e++)this._nodes[e].removeAllObservers()}update(){for(let e=0;e<this._nodes.length;e++)this._nodes[e].update();for(let e=0;e<this._actors.length;e++)this._actors[e].update(),this._actors[e].isDead()&&this.removeActor(this._actors[e])}renderBackground(){push(),translate(this._sectorRoot.position.x,this._sectorRoot.position.y),this.drawSectorBackdrop(),pop(),fill(0,0,0),noStroke(),rectMode(CORNER),rect(0,0,width,90),rect(0,height-90,width,90),rectMode(CENTER)}render(){for(let e=0;e<this._nodeConnections.length;e++)this._nodeConnections[e].render();for(let e=0;e<this._nodes.length;e++)this._nodes[e].render();for(let e=0;e<this._actors.length;e++)this._actors[e].render();for(let e=0;e<this._nodes.length;e++)this._nodes[e].drawName()}addNode(e){this._nodes.includes(e)?p("Node is already in this Sector!!!"):(this._nodes.push(e),e.setNodeObserver(this),this._sectorRoot.addChild(e))}removeNode(e){this._nodes.includes(e)?(this._nodes.splice(this._nodes.indexOf(e),1),e.setNodeObserver(null),this._sectorRoot.removeChild(e)):p("Node is not in this Sector!!!")}addActor(e,t){let o=(t instanceof g?t:this.getNode(t))??null;this._actors.includes(e)?p("Actor is already in this Sector!!!"):(e.currentSector=this,this._actors.push(e),this._sectorRoot.addChild(e),o!=null?e.setNode(o):(e.setScreenPosition(this.orbitNode.screenPosition.sub(new h(200,0))),e.moveToNode(this.orbitNode)))}removeActor(e){this._actors.includes(e)?(e.currentNode=null,e.currentSector=null,e.lastSector=this,this._actors.splice(this._actors.indexOf(e),1),this._sectorRoot.removeChild(e)):p("Actor is not in this Sector!!!")}};var F=class s extends m{static{this.BOX_WIDTH=700}static{this.BOX_HEIGHT=400}constructor(e){super(),this._exploreData=e.getExploreData(),this.overlay=!0,this.addButtonToToolbar(this._databaseButton=new a("\u67E5\u770B\u6570\u636E\u5E93",0,0,150,50)),this.addButtonToToolbar(this._waitButton=new a("\u7B49\u5F85 [ 1\u5206\u949F ]",0,0,150,50)),this.addButtonToToolbar(this._backButton=new a("\u7EE7\u7EED",0,0,150,50)),this._exploreData.parseJSON()}update(){}renderBackground(){}render(){push(),translate(width/2-s.BOX_WIDTH/2,height/2-s.BOX_HEIGHT/2),stroke(0,0,100),fill(0,0,0),rectMode(CORNER),rect(0,0,s.BOX_WIDTH,s.BOX_HEIGHT),fill(0,0,100),textFont(S),textSize(18),textAlign(LEFT,TOP),text(this._exploreData.getExploreText(),10,10,s.BOX_WIDTH-20,s.BOX_HEIGHT-10),pop(),r.render(),_.renderTimer()}onEnter(){}onExit(){}onInvokeClue(e){this._exploreData.canClueBeInvoked(e.id)?(i.popScreen(),this._exploreData.invokeClue(e.id),this._exploreData.explore()):c.player.currentSector!=null&&c.player.currentSector.canClueBeInvoked(e)?(i.popScreen(),c.player.currentSector.invokeClue(e)):r.publish("\u90A3\u4E2A\u73B0\u5728\u8FD8\u4E0D\u80FD\u5E2E\u52A9\u5230\u4F60",!0)}onButtonUp(e){e==this._databaseButton?(i.pushScreen(i.databaseScreen),i.databaseScreen.setObserver(this)):e==this._backButton?i.popScreen():e==this._waitButton&&(_.waitFor(1),this._exploreData.explore())}onButtonEnterHover(e){}onButtonExitHover(e){}};var V=class{constructor(){this._prompt="";this._mouseButton=LEFT}setObserver(e){this._observer=e}getMouseButton(){return this._mouseButton}setMouseButton(e){this._mouseButton=e}getCost(){return 0}getPrompt(){return this._prompt}setPrompt(e){this._mouseButton==LEFT?this._prompt+="\u5DE6\u952E - "+e:this._prompt+="\u53F3\u952E - "+e,this._prompt+=" [ "+this.getCost()+" \u5206\u949F ]"}},ve=class extends V{constructor(e,t,o,n){super(),this._player=t,this._location=o,this.setMouseButton(e),this.setObserver(n),this.setPrompt("\u53D1\u5C04\u4FA6\u5BDF\u5175")}execute(){r.publish("\u4F60\u770B\u89C1\u4E86"+this._location.getProbeDescription());let e=new K;this._player.currentSector.addActor(e),e.setScreenPosition(this._player.screenPosition),e.moveToNode(this._location),this._observer.onProbeNode(this._location)}},Se=class extends V{constructor(e,t,o){super(),this._location=t,this.setMouseButton(e),this.setObserver(o),this.setPrompt("\u63A2\u7D22")}getCost(){return 1}execute(){_.spendActionPoints(this.getCost()),_.getActionPoints()!=0&&(r.clear(),r.publish("\u4F60\u63A2\u7D22\u4E86"+this._location.getActualName()),this._observer.onExploreNode(this._location),i.pushScreen(new F(this._location)),this._location.explore())}},q=class extends V{constructor(e,t,o,n,l){super(),this._ship=o,this._player=t,this._destination=n,this.setMouseButton(e),this.setObserver(l),this.setPrompt()}setPrompt(e){if(e!==void 0)return super.setPrompt(e);if(this._ship!=null){if(this._ship.currentNode==null&&this._destination.gravity){this.setPrompt("\u964D\u843D\u5230\u6B64\u5904");return}this.setPrompt("\u98DE\u5230\u6B64\u5904")}else this._destination.gravity?this.setPrompt("\u79FB\u52A8\u5230\u6B64\u5904"):this.setPrompt("\u98DE\u5230\u6B64\u5904")}getCost(){return 1}execute(){if(r.clear(),this._player.currentNode!=null){let e=this._destination.getConnection(this._player.currentNode);if(e!=null){if(!e.traversibleFrom(this._player.currentNode)){e.fireFailEvent(),r.publish(e.getWrongWayText(),!0);return}e.fireTraverseEvent(),e.traverse(),e.hasDescription()&&r.publish("\u4F60\u7A7F\u8FC7\u4E86"+e.getDescription())}}this._destination.hasDescription()&&r.publish("\u4F60\u5DF2\u62B5\u8FBE"+this._destination.getDescription()),this._ship!=null&&this._ship.moveToNode(this._destination),u.sendMessage("reset reachability"),this._player.moveToNode(this._destination),this._observer.onTravelAttempt(!0,this._destination,this._destination.getConnection(this._player.currentNode)),_.spendActionPoints(this.getCost())}};var Oe=class{constructor(e){this._dragging=!1;this._activeSector=e,this._saveButton=new a("\u4FDD\u5B58",width-75,height-50,100,50),this._saveButton.setObserver(this)}update(){this._saveButton.update(),this._selection!=null&&(this._dragging&&(this._selection.setScreenPosition(new h(mouseX,mouseY)),mouseIsPressed||(this._selection.savePosition(),this._selection=null,this._dragging=!1)),this._dragging=mouseIsPressed&&mouseButton==CENTER)}render(){this._saveButton.render()}onButtonUp(e){e==this._saveButton&&this._activeSector.saveSectorJSON()}onNodeGainFocus(e){this._selection=e}onNodeLoseFocus(e){this._dragging||(this._selection=null)}onTravelToNode(e){}onExploreNode(e){}onProbeNode(e){}onButtonEnterHover(e){}onButtonExitHover(e){}onNodeSelected(e){}};var xe=class extends m{constructor(t,o,n){super();this._actionlessPrompt="inaccessible";this._actions=new Array,this._editor=new Oe(t),this._player=o,this._ship=n,this._sector=t,this.addButtonToToolbar(this._databaseButton=new a("\u67E5\u770B\u6570\u636E\u5E93",0,0,150,50)),this.addButtonToToolbar(this._telescopeButton=new a("\u626B\u63CF\u4FE1\u53F7",0,0,150,50)),this._telescopeButton.setDisabledPrompt(`\u626B\u63CF\u4FE1\u53F7
\uFF08\u89C6\u91CE\u53D7\u963B\uFF09`),this.addButtonToToolbar(this._waitButton=new a("\u7B49\u5F85 [ 1 \u5206\u949F ]",0,0,150,50)),this.addButtonToToolbar(this._liftoffButton=new a("\u79BB\u5F00\u8BE5\u533A\u57DF",0,0,150,50)),this._liftoffButton.setDisabledPrompt(`\u79BB\u5F00\u8BE5\u533A\u57DF
\uFF08\u5FC5\u987B\u4F4D\u4E8E\u98DE\u8239\u65C1\u8FB9\uFF09`)}onEnter(){this._sector.addNodeButtonObserver(this),this._sector.addNodeButtonObserver(this._editor),this._sector.updateNodeRanges(this.isPlayerInShip(),this._player.currentNode),this._focusNode=null}onExit(){this._sector.removeAllNodeButtonObservers()}onButtonUp(t){t==this._databaseButton?(i.databaseScreen.setObserver(this),i.pushScreen(i.databaseScreen)):t==this._liftoffButton?(this._sector.removeActor(this._player),this._sector.removeActor(this._ship),i.loadSolarSystemMap(),r.clear(),r.publish("\u4F60\u5DF2\u79BB\u5F00"+this._sector.getName())):t==this._telescopeButton?i.loadTelescopeView():t==this._waitButton&&_.waitFor(1)}onInvokeClue(t){if(this._player.currentNode!=null&&this._player.currentNode.isExplorable()){let o=this._player.currentNode.getExploreData();if(o.parseJSON(),o.canClueBeInvoked(t.id)){i.popScreen(),i.pushScreen(new F(this._player.currentNode)),o.invokeClue(t.id),o.explore();return}}this._player.currentSector!=null&&this._player.currentSector.canClueBeInvoked(t)?this._player.currentSector.invokeClue(t):r.publish("\u90A3\u4E2A\u73B0\u5728\u8FD8\u4E0D\u80FD\u5E2E\u52A9\u5230\u4F60",!0)}update(){this._liftoffButton.enabled=this._player.currentNode==this._ship.currentNode,this._telescopeButton.enabled=this._player.currentNode!=null&&this._player.currentNode.allowTelescope&&this._player.currentSector.allowTelescope(),this._sector.update(),L&&this._editor.update()}renderBackground(){super.renderBackground(),this._sector.renderBackground()}render(){this._sector.render(),r.render(),_.renderTimer(),fill(0,0,100),textSize(18),textFont(S),textAlign(RIGHT),text(this._sector.getName(),width-20,height-100),this.active&&(L&&this._editor.render(),this.drawNodeGUI(this._focusNode,this._actions))}drawNodeGUI(t,o){if(t==null||this._actions.length==0&&t==this._player.currentNode)return;st();let n=60,l=textWidth(this._actionlessPrompt);for(let b=0;b<o.length;b++)l=max(l,textWidth(o[b].getPrompt()));stroke(200,100,100),fill(0,0,0),rectMode(CORNER),rect(t.screenPosition.x-l*.5-10,t.screenPosition.y+n-15,l+15,max(20,20*o.length)+10),fill(0,0,100),textAlign(LEFT,CENTER);for(let b=0;b<o.length;b++)text(o[b].getPrompt(),t.screenPosition.x-l*.5,t.screenPosition.y+n+20*b);o.length==0&&text(this._actionlessPrompt,t.screenPosition.x-l*.5,t.screenPosition.y+n)}onTravelAttempt(t,o,n){}onExploreNode(t){}onProbeNode(t){}onNodeSelected(t){for(let o=0;o<this._actions.length;o++)if(this._actions[o].getMouseButton()==mouseButton){this._actions[o].execute();break}this.refreshAvailableActions()}onNodeGainFocus(t){this._focusNode=t,this.refreshAvailableActions()}onNodeLoseFocus(t){t==this._focusNode&&(this._focusNode=null,this.refreshAvailableActions())}refreshAvailableActions(){this._actions.length=0,this._focusNode!=null&&(this._player.currentNode!=this._focusNode?this._focusNode.inRange()&&(this._focusNode.isProbeable()&&this._actions.push(new ve(RIGHT,this._player,this._focusNode,this)),this.isPlayerInShip()&&this._focusNode.shipAccess?this._actions.push(new q(LEFT,this._player,this._ship,this._focusNode,this)):this._actions.push(new q(LEFT,this._player,null,this._focusNode,this))):this._focusNode.isExplorable()&&this._actions.push(new Se(LEFT,this._focusNode,this)))}isPlayerInShip(){return this._player.currentNode==this._ship.currentNode}};var Ne=class extends m{constructor(e,t){super(),this._sector=e,this._telescope=t,this._signalSources=e.getSectorSignalSources(),this.addButton(this._nextFrequency=new D(!0)),this.addButton(this._previousFrequency=new D(!1)),this.addButtonToToolbar(this._zoomOutButton=new a("\u7F29\u5C0F",0,0,150,50)),this.addButtonToToolbar(this._exitButton=new a("\u9000\u51FA",0,0,150,50))}onEnter(){noCursor()}onExit(){cursor(HAND)}update(){this._telescope.update(this._signalSources)}renderBackground(){super.renderBackground(),this._sector.renderBackground()}render(){this._sector.render(),this._telescope.render()}onButtonUp(e){e==this._exitButton?(i.popScreen(),i.popScreen()):e==this._zoomOutButton?i.popScreen():e==this._nextFrequency?this._telescope.nextFrequency():e==this._previousFrequency&&this._telescope.previousFrequency()}};var ye=class extends g{constructor(e,t){super(e,t),this.entryPoint=!0,this.shipAccess=!0,this.gravity=!1,this._visible=!0}getKnownName(){return this._visited?"\u9B9F\u9C47\u9C7C":"\uFF1F\uFF1F\uFF1F"}getDescription(){return"\u4E00\u6761\u5DE8\u5927\u800C\u9965\u997F\u7684\u9B9F\u9C47\u9C7C"}getProbeDescription(){return"\u4E00\u675F\u5149\u7A7F\u8FC7\u96FE\u6C14"}hasDescription(){return!0}isProbeable(){return!0}isExplorable(){return!0}visit(){this._visited=!0,this.setVisible(!0),u.sendMessage("death by anglerfish"),this._observer!=null&&this._observer.onNodeVisited(this)}};var Be=class extends g{constructor(e,t){super(e,t)}updateQuantumStatus(e){let t=this._nodeJSONObj.getInt("quantum location")==e;if(this.setVisible(t),!t)for(let o of this._connections.values())o.setVisible(t)}allowQuantumEntanglement(){return this._nodeJSONObj.getInt("quantum location")==c.getQuantumMoonLocation()&&this._nodeJSONObj.getBoolean("entanglement node",!1)}};var we=class extends N{load(){this._name="\u5F57\u661F",this.loadFromJSON("data/sectors/comet.json")}drawSectorBackdrop(){stroke(200,30,100),fill(0,0,0),ellipse(0,0,300,300)}},Te=class extends N{load(){this._name="\u4F59\u70EC\u53CC\u661F",this.loadFromJSON("data/sectors/rocky_twin.json")}drawSectorBackdrop(){stroke(60,100,100),fill(0,0,0),ellipse(0,0,500,500)}},Ee=class extends N{load(){this._name="\u7070\u70EC\u53CC\u661F",this.loadFromJSON("data/sectors/sandy_twin.json")}drawSectorBackdrop(){stroke(60,100,100),fill(0,0,0),ellipse(0,0,500,500)}},Pe=class extends N{load(){this._name="\u6728\u7076\u661F",this.loadFromJSON("data/sectors/timber_hearth.json")}drawSectorBackdrop(){stroke(200,100,100),fill(0,0,0),ellipse(0,0,500,500)}},Ae=class extends N{load(){this._name="\u788E\u7A7A\u661F",this.loadFromJSON("data/sectors/brittle_hollow.json")}drawSectorBackdrop(){stroke(0,100,100),fill(0,0,0),ellipse(0,0,500,500),this.drawBlackHole(35)}drawBlackHole(e){noStroke(),fill(0,100,0),ellipse(0,0,e*.5,e*.5),noFill(),strokeWeight(1),stroke(260,80,70);let t=e*.125,o=e,n=3,l=.1*PI,b=t,P=0;for(let R=l;R<n*TWO_PI;R+=l){let v=R,w=v/(n*TWO_PI)*(o-t)+t,rt=w*cos(v),nt=w*sin(v);v-=l/3,w=v/(n*TWO_PI)*(o-t)+t;let ft=w*cos(v),vt=w*sin(v);v-=l/3,w=v/(n*TWO_PI)*(o-t)+t;let St=w*cos(v),Ot=w*sin(v);bezier(b,P,St,Ot,ft,vt,rt,nt),b=rt,P=nt}}},Ce=class extends N{load(){this._name="\u6DF1\u5DE8\u661F",this.loadFromJSON("data/sectors/giants_deep.json"),this.setAnchorOffset(0,60)}drawSectorBackdrop(){fill(0,0,0),stroke(180,100,100),ellipse(0,0,600,600),stroke(200,100,60),ellipse(0,0,400,400)}},ke=class extends N{constructor(){super(),this._fogLightNodes=new Array,this._fogLightPositions=new Array}load(){this._name="\u9ED1\u8346\u661F",this.loadFromJSON("data/sectors/dark_bramble.json");for(let e=0;e<this._fogLightNodes.length;e++){let t=int(random(0,this._fogLightPositions.length));this._fogLightNodes[e].setPosition(this._fogLightPositions[t]),this._fogLightPositions.splice(t,1)}}createNode(e,t){let o;return t.hasKey("anglerfish")?(o=new ye(e,t),this._fogLightNodes.push(o),this._fogLightPositions.push(new h(o.position))):o=new g(e,t),t.getBoolean("fog light",!1)&&(this._fogLightNodes.push(o),this._fogLightPositions.push(new h(o.position))),o}drawSectorBackdrop(){stroke(120,100,100),fill(0,0,0),ellipse(100,0,700,500)}},De=class extends N{constructor(){super(...arguments);this._quantumLocation=0;this._turnsSinceEOTU=0}load(){this._name="\u91CF\u5B50\u536B\u661F",this.loadFromJSON("data/sectors/quantum_moon.json")}onReceiveGlobalMessage(t){t.id==="quantum entanglement"&&c.player.currentSector==this&&(this.collapse(),this.onQuantumEntanglement())}onArrival(){i.pushScreen(new ae)}createNode(t,o){return new Be(t,o)}collapse(){let t=this._quantumLocation;for(;t==this._quantumLocation;)t=int(random(5));this._quantumLocation=t,this._quantumLocation!=4&&(this._turnsSinceEOTU++,this._turnsSinceEOTU>4&&(this._quantumLocation=4,this._turnsSinceEOTU=0));for(let o=0;o<this._nodes.length;o++)this._nodes[o].updateQuantumStatus(this._quantumLocation)}onQuantumEntanglement(){super.onQuantumEntanglement(),c.ship.currentSector==this&&c.ship.currentSector.removeActor(c.ship)}getQuantumLocation(){return this._quantumLocation}allowTelescope(){return!1}drawSectorBackdrop(){stroke(300,50,100),fill(0,0,0),ellipse(0,0,300,300)}removeActor(t){super.removeActor(t),t.lastSector=null}},Le=class extends N{load(){this._name="\u6BD4\u5B87\u5B99\u66F4\u4E3A\u53E4\u8001\u7684\u4E8B\u7269",this.loadFromJSON("data/sectors/eye_of_the_universe.json")}allowTelescope(){return!1}drawSectorBackdrop(){}};var Re=class{constructor(){u.addObserver(this),p("Solar System loading..."),this._sectorList=new Array,this._sectorList.push(this.comet=new we),this._sectorList.push(this.rockyTwin=new Te),this._sectorList.push(this.sandyTwin=new Ee),this._sectorList.push(this.timberHearth=new Pe),this._sectorList.push(this.brittleHollow=new Ae),this._sectorList.push(this.giantsDeep=new Ce),this._sectorList.push(this.darkBramble=new ke),this._sectorList.push(this.quantumMoon=new De),this._sectorList.push(this.eyeOfTheUniverse=new Le),this.comet.load(),this.rockyTwin.load(),this.sandyTwin.load(),this.timberHearth.load(),this.brittleHollow.load(),this.giantsDeep.load(),this.darkBramble.load(),this.quantumMoon.load(),this.eyeOfTheUniverse.load(),this.player=new z,this.ship=new Q(this.player)}onReceiveGlobalMessage(e){if(e.id==="spawn ship"){this.timberHearth.addActor(this.ship,"\u6751\u5E84");let t=this.player.currentNode;this.timberHearth.removeActor(this.player),this.timberHearth.addActor(this.player,t)}else if(e.id==="move to"){let t=this.getNodeByName(e.text);this.player.moveToNode(t),t.shipAccess&&this.ship.moveToNode(t),r.clear(),r.publish("\u4F60\u5DF2\u62B5\u8FBE"+t.getDescription())}else if(e.id==="teleport to")for(let t=0;t<this._sectorList.length;t++){let o=this._sectorList[t].getNode(e.text);o!=null&&(this.player.currentSector.removeActor(this.player),this._sectorList[t].addActor(this.player,o),i.loadSector(this._sectorList[t]),r.clear(),r.publish("\u4F60\u5DF2\u88AB\u4F20\u9001\u81F3"+o.getDescription()))}else e.id==="quantum moon vanished"&&(this.player.currentSector.removeActor(this.player),this.ship.currentSector.removeActor(this.ship),i.loadSolarSystemMap())}isPlayerInShip(){return this.player.currentNode===this.ship.currentNode}getNodeByName(e){for(let t=0;t<this._sectorList.length;t++){let o=this._sectorList[t].getNode(e);if(o!=null)return o}return null}getSectorByName(e){switch(e){case 7:return this.comet;case 1:return this.rockyTwin;case 2:return this.sandyTwin;case 3:return this.timberHearth;case 4:return this.brittleHollow;case 5:return this.giantsDeep;case 6:return this.darkBramble;case 8:return this.quantumMoon;case 9:return this.eyeOfTheUniverse;default:break}return null}};var k=class extends a{constructor(e,t,o,n,l,b){super(e,t,o,n,l),this.node=new g(t,o),this._sector=b}getRadius(){return this._bounds.y*.5}getSector(){return this._sector}render(){this.drawNonHighlighted(),this.hoverState&&strokeWeight(2),this.drawPlanet(),this.drawYouAreHere(),strokeWeight(1)}drawNonHighlighted(){}drawName(e,t){fill(0,0,100),textAlign(CENTER,CENTER),textSize(18),text(e??this.id,t??this.screenPosition.x,this.screenPosition.y-this.getRadius()-40)}drawYouAreHere(){c.ship.currentSector==this._sector&&c.ship.drawAt(this.screenPosition.x,this.screenPosition.y,.5,!0),c.player.currentSector==this._sector&&c.player.drawAt(this.screenPosition.x,this.screenPosition.y,.5)}drawZoomPrompt(){textSize(14),textFont(E),fill(0,0,0),stroke(0,0,100),rectMode(CENTER),rect(this.screenPosition.x,this.screenPosition.y+this.getRadius()+40,textWidth("\u5DE6\u952E\u653E\u5927")+10,20),fill(0,0,100),textAlign(CENTER,CENTER),text("\u5DE6\u952E\u653E\u5927",this.screenPosition.x,this.screenPosition.y+this.getRadius()+40)}},Me=class extends k{constructor(e,t,o){super("\u5F57\u661F",e,t,40,40,o)}drawPlanet(){noStroke(),fill(0,0,0),push(),translate(this.screenPosition.x,this.screenPosition.y),triangle(0,this.getRadius(),0,-this.getRadius(),130,0),stroke(200,30,100),arc(0,0,this._bounds.y,this._bounds.y,PI*.5,PI*1.5),line(0,this._bounds.y*.5,130,0),line(0,-this._bounds.y*.5,130,0),pop()}},U=class extends k{constructor(t,o,n,l){super("\u70EC\u53CC\u661F",t,o,50,50,l);this._isRightTwin=!1;this._isRightTwin=n,this._centerX=t,n?(this._twinName="\u7070",this.setPosition(t+35,this.position.y)):(this._twinName="\u4F59",this.setPosition(t-35,this.position.y))}drawName(){super.drawName(this._twinName+this.id,this._centerX)}drawNonHighlighted(){this._isRightTwin||(stroke(60,100,100),fill(0,0,0),rectMode(CENTER),rect(this._centerX,this.position.y,this._bounds.y*1.5,this._bounds.y*.2))}drawPlanet(){stroke(60,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.y,this._bounds.y)}},Ie=class extends k{constructor(e,t,o){super("\u6728\u7076\u661F",e,t,80,80,o)}drawPlanet(){stroke(200,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}},We=class extends k{constructor(e,t,o){super("\u788E\u7A7A\u661F",e,t,80,80,o)}drawPlanet(){stroke(0,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}},Fe=class extends k{constructor(e,t,o){super("\u6DF1\u5DE8\u661F",e,t,150,150,o)}drawPlanet(){stroke(180,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}},Je=class extends k{constructor(e,t,o){super("\u9ED1\u8346\u661F",e,t,230,230,o)}drawPlanet(){stroke(120,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}},je=class extends k{constructor(e,t){super("\u91CF\u5B50\u536B\u661F",0,0,30,30,t),this._targets=e}collapse(){this._sector.collapse(),this.updatePosition()}updatePosition(){let e=this._sector.getQuantumLocation();p(e),e==4?this._currentTarget=null:this._currentTarget=this._targets[e],this._currentTarget!=null?this.setPosition(this._currentTarget.position.x-25,this._currentTarget.position.y-this._currentTarget.getRadius()-30):this.setPosition(-1e3,-1e3)}drawPlanet(){stroke(300,50,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}};var He=class extends m{constructor(e){super(),this._solarSystem=e,this._player=e.player,this._ship=e.ship,this._sectorButtons=new Array;let t=height/2;this._sectorButtons.push(this._hourglassButton_left=new U(170,t,!1,this._solarSystem.rockyTwin)),this._sectorButtons.push(this._hourglassButton_right=new U(170,t,!0,this._solarSystem.sandyTwin)),this._sectorButtons.push(this._timberButton=new Ie(300,t,this._solarSystem.timberHearth)),this._sectorButtons.push(this._brittleButton=new We(420,t,this._solarSystem.brittleHollow)),this._sectorButtons.push(this._giantsButton=new Fe(580,t,this._solarSystem.giantsDeep)),this._sectorButtons.push(this._darkButton=new Je(810,t,this._solarSystem.darkBramble)),this._sectorButtons.push(this._cometButton=new Me(600,t+200,this._solarSystem.comet));let o=[this._hourglassButton_right,this._timberButton,this._brittleButton,this._giantsButton];this._sectorButtons.push(this._quantumButton=new je(o,this._solarSystem.quantumMoon));for(let n=0;n<this._sectorButtons.length;n++)this.addButton(this._sectorButtons[n])}onEnter(){this._quantumButton.collapse()}update(){}render(){stroke(40,100,100),fill(0,0,0),ellipse(-430,height/2,1e3,1e3),this._ship.currentSector==null&&this._ship.render(),this._player.currentSector==null&&this._player.render()}onButtonEnterHover(e){this._sectorButtons.includes(e)&&(this._focusSectorButton=e)}onButtonExitHover(e){e===this._focusSectorButton&&(this._focusSectorButton=null)}onButtonUp(e){this._sectorButtons.includes(e)&&this.selectSector(e.getSector())}selectSector(e){}getSectorScreenPosition(e){for(let t=0;t<this._sectorButtons.length;t++)if(this._sectorButtons[t].getSector()==e)return this._sectorButtons[t].screenPosition;return null}},Ve=class extends He{constructor(e,t){super(e),this.addButton(this._nextFrequency=new D(!0)),this.addButton(this._previousFrequency=new D(!1)),this.addButtonToToolbar(this._exitButton=new a("\u9000\u51FA",0,0,150,50)),this._telescope=t}onEnter(){super.onEnter(),noCursor(),this._signalSources=new Array,this._signalSources.push(new B(this._cometButton.screenPosition,this._cometButton.getSector())),this._signalSources.push(new B(this._hourglassButton_left.screenPosition,this._hourglassButton_left.getSector())),this._signalSources.push(new B(this._timberButton.screenPosition,this._timberButton.getSector())),this._signalSources.push(new B(this._brittleButton.screenPosition,this._brittleButton.getSector())),this._signalSources.push(new B(this._giantsButton.screenPosition,this._giantsButton.getSector())),this._signalSources.push(new B(this._darkButton.screenPosition,this._darkButton.getSector())),this._signalSources.push(new B(this._quantumButton.screenPosition,this._quantumButton.getSector()))}onExit(){cursor(HAND)}update(){super.update(),this._telescope.update(this._signalSources)}render(){super.render(),this._telescope.render(),this._focusSectorButton!=null&&this._focusSectorButton.drawName(),this._focusSectorButton!=null&&this._focusSectorButton.drawZoomPrompt()}selectSector(e){i.loadSectorTelescopeView(e)}onButtonUp(e){super.onButtonUp(e),e==this._exitButton?i.popScreen():e==this._nextFrequency?this._telescope.nextFrequency():e==this._previousFrequency&&this._telescope.previousFrequency()}},qe=class extends He{constructor(e){super(e),this.addButtonToToolbar(this._databaseButton=new a("\u67E5\u770B\u6570\u636E\u5E93",0,0,150,50)),this.addButtonToToolbar(this._telescopeButton=new a("\u626B\u63CF\u4FE1\u53F7",0,0,150,50))}render(){super.render(),this._focusSectorButton!=null&&this._focusSectorButton.drawName(),r.render(),_.renderTimer()}onEnter(){super.onEnter(),this.setActorPosition(this._player),this.setActorPosition(this._ship)}setActorPosition(e){let t=new h(200,height-200);e.lastSector!=null?e.setScreenPosition(this.getSectorScreenPosition(e.lastSector)):e.setScreenPosition(t),e.moveToScreenPosition(t),e.lastSector=null}update(){this._player.update(),this._ship.update()}onButtonUp(e){e==this._databaseButton?i.pushScreen(i.databaseScreen):e==this._telescopeButton&&i.loadTelescopeView(),super.onButtonUp(e)}selectSector(e){let t=e;this._solarSystem.ship.currentSector==null&&t.addActor(this._solarSystem.ship),this._solarSystem.player.currentSector==null&&t.addActor(this._solarSystem.player),i.loadSector(t),t.onArrival()}};var Ue=class s extends m{constructor(){super();this.initTime=0;this.collapsePercent=0;this.supernovaPercent=0}static{this.SUN_SIZE=300}static{this.COLLAPSE_DURATION=2e3}static{this.SUPERNOVA_SIZE=2e3}static{this.SUPERNOVA_DURATION=2e3}onEnter(){this.initTime=millis(),this.collapseTime=this.initTime+1*500,this.supernovaTime=this.collapseTime+s.COLLAPSE_DURATION,r.clear(),r.publish("\u592A\u9633\u6B63\u5728\u6F14\u5316\u4E3A\u8D85\u65B0\u661F\uFF01",!0)}onExit(){}update(){this.collapsePercent=constrain((millis()-this.collapseTime)/s.COLLAPSE_DURATION,0,1),this.collapsePercent=this.collapsePercent*this.collapsePercent*this.collapsePercent,this.supernovaPercent=constrain((millis()-this.supernovaTime)/s.SUPERNOVA_DURATION,0,1),this.supernovaPercent=this.supernovaPercent*this.supernovaPercent,this.supernovaPercent==1&&d.killPlayer()}render(){push(),translate(width/2,height/2),noStroke(),fill(300*this.supernovaPercent,100,100),ellipse(0,0,5+s.SUPERNOVA_SIZE*this.supernovaPercent,5+s.SUPERNOVA_SIZE*this.supernovaPercent*(1-this.supernovaPercent*.5)),this.collapsePercent<1&&(stroke(40,100,100),fill(0,0,0),ellipse(0,0,s.SUN_SIZE*(1-this.collapsePercent),s.SUN_SIZE*(1-this.collapsePercent))),pop(),r.render()}onButtonUp(t){}},Ge=class s extends m{constructor(){super();this.initTime=0;this.lastSpawnTime=0;this.flashbackPercent=0;this._ringSizes=new Array}static{this.FLASHBACK_DURATION=2200}onEnter(){this.initTime=millis(),r.clear(),r.publish("?!gnineppah s'tahW",!0)}onExit(){}update(){millis()-this.lastSpawnTime>50&&random(1)>.3&&(this.lastSpawnTime=millis(),this._ringSizes.push(5));for(let t=0;t<this._ringSizes.length;t++)this._ringSizes[t]=this._ringSizes[t]+this._ringSizes[t]*.1+.5;this.getFlashBackPercent()==1&&i.resetTimeLoop()}getFlashBackPercent(){return constrain((millis()-this.initTime)/s.FLASHBACK_DURATION,0,1)}render(){push(),translate(width/2,height/2);for(let o=0;o<this._ringSizes.length;o++)stroke(0,0,100),noFill(),ellipse(0,0,this._ringSizes[o],this._ringSizes[o]);pop();let t=constrain((this.getFlashBackPercent()-.9)/.1,0,1);fill(0,0,100,t*100),rectMode(CORNER),rect(0,0,width,height),r.render()}onButtonUp(t){}},ze=class extends m{constructor(){super(),this.addButtonToToolbar(new a("\u518D\u6B21\u5C1D\u8BD5"))}update(){}render(){fill(0,90,90),textAlign(CENTER,CENTER),textSize(100),text("\u4F60\u6B7B\u4E86",width/2,height/2)}onButtonUp(e){i.resetTimeLoop()}};var Qe=class extends _e{constructor(){super(...arguments);this._flashbackTriggered=!1}newGame(){this.setupSolarSystem(),this.titleScreen=new ee,this.databaseScreen=new Y,this.pushScreen(this.titleScreen)}resetTimeLoop(){this._flashbackTriggered=!1,this._screenStack.length=0,this.setupSolarSystem(),this.loadSector(3)}setupSolarSystem(){u.removeAllObservers(),u.addObserver(this),r.init(),_.init(),d.init(),this._telescope=new be,this._solarSystem=new Re,this._solarSystem.timberHearth.addActor(this._solarSystem.player,"\u6751\u5E84"),this.solarSystemMapScreen=new qe(this._solarSystem),d.knowsLaunchCodes()&&u.sendMessage("spawn ship"),bt()}lateUpdate(){_.lateUpdate(),d.isPlayerDead()&&!this._flashbackTriggered&&(this._flashbackTriggered=!0,_.getEnabled()?this.swapScreen(new Ge):this.swapScreen(new ze))}onReceiveGlobalMessage(t){t.id==="death by anglerfish"?this.pushScreen(new oe):t.id==="dive attempt"?this.pushScreen(new se):t.id==="follow the vine"?this.swapScreen(new ue):t.id==="explore ancient vessel"?this.swapScreen(new he):t.id==="time loop central"?this.swapScreen(new de):t.id==="older than the universe"?this.swapScreen(new ce):t.id==="explore bramble outskirts"&&this.swapScreen(new pe)}loadTelescopeView(){this.pushScreen(new Ve(this._solarSystem,this._telescope))}loadSectorTelescopeView(t){this.pushScreen(new Ne(t,this._telescope))}loadSolarSystemMap(){this.swapScreen(this.solarSystemMapScreen)}loadSector(t){let o=t instanceof N?t:this._solarSystem.getSectorByName(t);this.swapScreen(new xe(o,this._solarSystem.player,this._solarSystem.ship))}};var Ke=class{constructor(){this.player=i._solarSystem.player,this.ship=i._solarSystem.ship,this._quantumSector=i._solarSystem.quantumMoon}getQuantumMoonLocation(){return this._quantumSector.getQuantumLocation()}};var Ye=class s{static{this.MAX_LINES=3}init(){this._feed=new Array,u.addObserver(this)}clear(){this._feed.length=0}onReceiveGlobalMessage(e){}publish(e,t=!1){this._feed.push(new it(e,t)),this._feed.length>s.MAX_LINES&&this._feed.splice(0,1)}render(){for(let e=0;e<this._feed.length&&this._feed[e].draw(20,30+e*25);e++);}},it=class s{constructor(e,t){this._displayTriggered=!1;this._lineColor=color(0,0,100);this._line=e,t&&(this._lineColor=color(100,100,100))}static{this.SPEED=.08}draw(e,t){return this._displayTriggered||(this._initTime=millis(),this._displayTriggered=!0),textAlign(LEFT),textFont(S),textSize(18),fill(this._lineColor),text(this._line.substring(0,min(this._line.length,this.getDisplayLength())),e,t),textFont(E),this._line.length<=this.getDisplayLength()}getDisplayLength(){return int((millis()-this._initTime)*s.SPEED)}};var Xe=class s{static{this.ACTION_POINTS_PER_LOOP=15}init(){this._actionPoints=s.ACTION_POINTS_PER_LOOP,this._isTimeLoopEnabled=!0,this._triggerSupernova=!1,r.publish("\u4F60\u5728\u6751\u5E84\u53D1\u5C04\u5854\u4E0B\u7684\u7BDD\u706B\u65C1\u9192\u6765\u3002\u4ECA\u5929\u662F\u4E2A\u5927\u65E5\u5B50\uFF01"),r.publish("\u5728\u5929\u4E0A\uFF0C\u4F60\u6CE8\u610F\u5230\u4E00\u4E2A\u660E\u4EAE\u7684\u7269\u4F53\u6B63\u4ECE\u6DF1\u5DE8\u661F\u98DE\u79BB...",!0),u.addObserver(this)}onReceiveGlobalMessage(e){e.id==="\u5173\u95ED\u65F6\u95F4\u5FAA\u73AF"&&this._isTimeLoopEnabled&&(this._isTimeLoopEnabled=!1,r.publish("\u4F60\u5173\u95ED\u4E86\u65F6\u95F4\u5FAA\u73AF\u88C5\u7F6E",!0))}lateUpdate(){this._triggerSupernova&&(this._triggerSupernova=!1,i.swapScreen(new Ue))}getEnabled(){return this._isTimeLoopEnabled}getLoopPercent(){return(s.ACTION_POINTS_PER_LOOP-this._actionPoints)/s.ACTION_POINTS_PER_LOOP}getActionPoints(){return this._actionPoints}waitFor(e){r.publish("\u4F60\u7B49\u5F85\u4E86 1 \u5206\u949F",!0),this.spendActionPoints(e)}spendActionPoints(e){if(d.isPlayerAtEOTU())return;let t=this._actionPoints;this._actionPoints=max(0,this._actionPoints-e),u.sendMessage("action points spent"),t>s.ACTION_POINTS_PER_LOOP*.25&&this._actionPoints<=s.ACTION_POINTS_PER_LOOP*.25&&r.publish("\u4F60\u6CE8\u610F\u5230\u592A\u9633\u6B63\u53D8\u5F97\u53C8\u5927\u53C8\u7EA2\uFF0C\u5341\u5206\u7CDF\u7CD5",!0),this._actionPoints==0&&(this._triggerSupernova=!0)}renderTimer(){if(d.isPlayerAtEOTU())return;let e=50,t=50,o=height-50;stroke(0,0,100),fill(0,0,0),ellipse(t,o,e,e),fill(30,100,100),arc(t,o,e,e,0-PI*.5+TAU*this.getLoopPercent(),1.5*PI)}};var ot=14,c,i,_,u,r,d,et,Nt,L=!1,mt=!1,ht=!1,dt=!1,ct=!1,pt=!1,gt,yt,E,S;window.preload=function(){E=loadFont("data/fonts/JiangChengYuanTi-400W.ttf"),S=loadFont("data/fonts/JiangChengYuanTi-400W.ttf"),at("data/audio/ow_kazoo_theme.mp3"),T("data/sectors/brittle_hollow.json"),T("data/sectors/comet.json"),T("data/sectors/dark_bramble.json"),T("data/sectors/eye_of_the_universe.json"),T("data/sectors/giants_deep.json"),T("data/sectors/quantum_moon.json"),T("data/sectors/rocky_twin.json"),T("data/sectors/sandy_twin.json"),T("data/sectors/timber_hearth.json")};window.setup=function(){let e=document.getElementById("game-canvas");createCanvas(960,720,null,e),e.style.removeProperty("width"),e.style.removeProperty("height"),e.oncontextmenu=()=>!1,e.ontouchstart=o=>{mouseButton=o.touches.length===2?RIGHT:LEFT};let t=document.getElementById("full-screen-button");t.onclick=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},noSmooth(),colorMode(HSB,360,100,100,100),rectMode(CENTER),ellipseMode(CENTER),st(),et=new G,Bt()};function Bt(){let s=millis();_=new Xe,Nt=new A,u=new X,r=new Ye,i=new Qe,d=y.loadData(),i.newGame(),p("Load time:",millis()-s)}window.draw=function(){i.runGameLoop(),yt=millis()-gt,gt=millis()};function $(s){switch(s){case 2:return"\u65C5\u884C\u8005\u9891\u7387";case 0:return"\u6C42\u6551\u4FE1\u6807";case 1:return"\u91CF\u5B50\u6CE2\u52A8";default:return""}}function bt(){c=new Ke}function st(){textSize(14),textFont(E)}function Ki(){textSize(18),textFont(S)}})();
//# sourceMappingURL=bundle.js.map
